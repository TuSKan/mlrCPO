<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Martin Binder" />

<meta name="date" content="2017-12-16" />

<title>First Steps (No Output)</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">First Steps (No Output)</h1>
<h4 class="author"><em>Martin Binder</em></h4>
<h4 class="date"><em>2017-12-16</em></h4>



<div id="cpo-vignette-navigation" class="section level4">
<h4>CPO Vignette Navigation</h4>
<ol style="list-style-type: decimal">
<li><a href="a_1_getting_started.html">First Steps</a> (compact version)</li>
<li><a href="a_2_mlrCPO_core.html">mlrCPO Core</a> (<a href="z_2_mlrCPO_core_terse.html">compact version</a>)</li>
<li><a href="a_3_all_CPOs.html">CPOs Built Into mlrCPO</a> (<a href="z_3_all_CPOs_terse.html">compact version</a>)</li>
<li><a href="a_4_custom_CPOs.html">Building Custom CPOs</a> (<a href="z_4_custom_CPOs_terse.html">compact version</a>)</li>
</ol>
</div>
<div id="about-the-vignettes" class="section level2">
<h2>About the Vignettes</h2>
<p>Since <code>mlrCPO</code> is a package with some depth to it, it comes with a few vignettes that each explain different aspects of its operation. These are the current document (“First Steps”), offering a short introduction and information on where to get started, “<a href="a_2_mlrCPO_core.html">mlrCPO Core</a>”, describing all the functions and tools offered by <code>mlrCPO</code> that are independent from specific <code>CPO</code>s, “<a href="a_3_all_CPOs.html">CPOs Built Into mlrCPO</a>”, listing all <code>CPO</code>s included in the <code>mlrCPO</code> package, and “<a href="a_4_custom_CPOs.html">Building Custom CPOs</a>”, describing the process of creating new <code>CPO</code>s that offer new functionality.</p>
<p>All vignettes also have a “compact version” with the R output suppressed for readability. They are linked in the navigation section at the top.</p>
<p>All vignettes assume that <code>mlrCPO</code> (and therefore its requirement <code>mlr</code>) is installed successfully and loaded using <code>library(&quot;mlrCPO&quot;)</code>. Help with installation is provided on the <a href="https://github.com/mlr-org/mlrCPO">project’s GitHub page</a>.</p>
</div>
<div id="what-is-mlrcpo" class="section level2">
<h2>What is mlrCPO?</h2>
<p>“Composable Preprocessing Operators”, “CPO”, are an extension for the <a href="https://github.com/mlr-org/mlr">mlr</a> (“Machine Learning in R”) project which present preprocessing operations in the form of R objects. These CPO objects can be composed to form complex operations, they can be applied to data sets, and can be attached to mlr <code>Learner</code> objects to generate machine learning pipelines that combine preprocessing and model fitting.</p>
<div id="what-is-preprocessing" class="section level3">
<h3>What is Preprocessing</h3>
<p>“Preprocessing”, as understood by <code>mlrCPO</code>, is any manipulation of data used in a machine learning process to get it from its form as found in the wild into a form more fitting for the machine learning algorithm (“<code>Learner</code>”) used for model fitting. It is important that the exact method of preprocessing is kept track of, to be able to perform this method when the resulting model is used to make predictions on new data. It is also important, when evaluating preprocessing methods e.g. using <em>resampling</em>, that the parameters of these methods are independent of the validation dataset and only depend on the training data set.</p>
<p><code>mlrCPO</code> tries to support the user in all these aspects of preprocessing:</p>
<ol style="list-style-type: decimal">
<li>By providing a large set of atomic preprocessing <code>CPO</code>s that can perform many different operations. Operations that go beyond the provided toolset can be implemented in custom <code>CPO</code>s.</li>
<li>By using “<code>CPOTrained</code>” objects that represent the preprocessing done on training data that should, in that way, be re-applied to new prediction data.</li>
<li>By making it possible to combine preprocessing objects with <code>mlr</code> “<code>Learner</code>” objects that represent the entinre machine learning pipeline to be tuned and evaluated.</li>
</ol>
</div>
</div>
<div id="preprocessing-operations" class="section level2">
<h2>Preprocessing Operations</h2>
<p>At the centre of <code>mlrCPO</code> are “<code>CPO</code>” objects. To get a <code>CPO</code> object, it is necessary to call a <em>CPO Constructor</em>. A CPO Constructor sets up the parameters of a <code>CPO</code> and provides further options for its behaviour. Internally, CPO Constructors are <em>functions</em> that have a common interface and a friendly printer method.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpoScale  <span class="co"># a cpo constructor</span>
cpoAddCols

<span class="kw">cpoScale</span>(<span class="dt">center =</span> <span class="ot">FALSE</span>)  <span class="co"># create a CPO object that scales, but does not center, data</span>
<span class="kw">cpoAddCols</span>(<span class="dt">Sepal.Area =</span> Sepal.Length *<span class="st"> </span>Sepal.Width)  <span class="co">#  this would add a column</span></code></pre></div>
<p><code>CPO</code>s exist first to be <em>applied</em> to data. Every <code>CPO</code> represents a certain data transformation, and this transformation is performed when the <code>CPO</code> is applied. This can be done using the <strong><code>applyCPO</code></strong> function, or the <strong><code>%&gt;&gt;%</code></strong> operator. <code>CPO</code>s can be applied to <code>data.frame</code> objects, and to <code>mlr</code> “<code>Task</code>” objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris.demo =<span class="st"> </span>iris[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">51</span>, <span class="dv">52</span>, <span class="dv">102</span>), ]
<span class="kw">tail</span>(iris.demo %&gt;&gt;%<span class="st"> </span><span class="kw">cpoQuantileBinNumerics</span>())  <span class="co"># bin the data in below &amp; above median</span></code></pre></div>
<p>A useful feature of <code>CPO</code>s is that they can be concatenated t form new operations. Two <code>CPO</code>s can be combines using the <strong><code>composeCPO</code></strong> function or, as before, the <strong><code>%&gt;&gt;%</code></strong> operator. When two <code>CPO</code>s are combined, the product is a new <code>CPO</code> that can itself be composed or applied. When two <code>CPO</code>s are composed, the result represents the operation of first applying the first, then the second <code>CPO</code>. Therefore, <code>data %&gt;&gt;% (cpo1 %&gt;&gt;% cpo2)</code> is the same as <code>(data %&gt;&gt;% cpo1) %&gt;&gt;% cpo2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first create three quantile bins, then as.numeric() all columns to</span>
<span class="co"># get 1, 2 or 3 as the bin number</span>
quantilenum =<span class="st"> </span><span class="kw">cpoQuantileBinNumerics</span>(<span class="dt">numsplits =</span> <span class="dv">3</span>) %&gt;&gt;%<span class="st"> </span><span class="kw">cpoAsNumeric</span>()
iris.demo %&gt;&gt;%<span class="st"> </span>quantilenum</code></pre></div>
<p>The last example shows that it is sometimes not a good idea to have a <code>CPO</code> affect the whole dataset. Therefore, when a <code>CPO</code> is created, it is possible to choose what columns the <code>CPO</code> should affect. The CPO Constructor has a variety of parameters, starting with <code>affect.</code>, that can be used to choose what columns the <code>CPO</code> operates on. To prevent <code>cpoAsNumeric</code> from influencing the <code>Species</code> column, we can thus do</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">quantilenum.restricted =<span class="st"> </span><span class="kw">cpoQuantileBinNumerics</span>(<span class="dt">numsplits =</span> <span class="dv">3</span>) %&gt;&gt;%
<span class="st">  </span><span class="kw">cpoAsNumeric</span>(<span class="dt">affect.names =</span> <span class="st">&quot;Species&quot;</span>, <span class="dt">affect.invert =</span> <span class="ot">TRUE</span>)
iris.demo %&gt;&gt;%<span class="st"> </span>quantilenum.restricted</code></pre></div>
<p>A more convenient method in this case, however, is to use an <code>mlr</code> “<code>Task</code>”, which keeps track of the target column. “Feature Operation” <code>CPO</code>s (as all the ones shown) do not influence the target column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">demo.task =<span class="st"> </span><span class="kw">makeClassifTask</span>(<span class="dt">data =</span> iris.demo, <span class="dt">target =</span> <span class="st">&quot;Species&quot;</span>)
result =<span class="st"> </span>demo.task %&gt;&gt;%<span class="st"> </span>quantilenum
<span class="kw">getTaskData</span>(result)</code></pre></div>
</div>
<div id="hyperparameters" class="section level2">
<h2>Hyperparameters</h2>
<p>When performing preprocessing, it is sometimes necessary to change a small aspect of a long preprocessing pipeline. Instead of having to re-construct the whole pipeline, <code>mlrCPO</code> offers the possibility to change <em>hyperparameters</em> of a <code>CPO</code>. This makes it very easy e.g. for tuning of preprocessing in combination with a machine learning algorithm.</p>
<p>Hyperparameters of <code>CPO</code>s can be manipulated in the same way as they are manipulated for <code>Learners</code> in <code>mlr</code>, using <strong><code>getParamSet</code></strong> (to list the parameters), <strong><code>getHyperPars</code></strong> (to list the parameter values), and <strong><code>setHyperPars</code></strong> (to change these values). To get the parameter set of a <code>CPO</code>, it is also possible to use <strong>verbose printing</strong> using the <code>!</code> (exclamation mark) operator.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpo =<span class="st"> </span><span class="kw">cpoScale</span>()
cpo
<span class="kw">getHyperPars</span>(cpo)  <span class="co"># list of parameter names and values</span>
<span class="kw">getParamSet</span>(cpo)  <span class="co"># more detailed view of parameters and their type / range</span>
!cpo  <span class="co"># equivalent to print(cpo, verbose = TRUE)</span></code></pre></div>
<p><code>CPO</code>s use copy semantics, therefore <code>setHyperPars</code> creates a copy of a <code>CPO</code> that has the changed hyperparameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpo2 =<span class="st"> </span><span class="kw">setHyperPars</span>(cpo, <span class="dt">scale.scale =</span> <span class="ot">FALSE</span>)
cpo2
iris.demo %&gt;&gt;%<span class="st"> </span>cpo  <span class="co"># scales and centers</span>
iris.demo %&gt;&gt;%<span class="st"> </span>cpo2 <span class="co"># only centers</span></code></pre></div>
<p>When chaining many <code>CPO</code>s, it is possible for the many hyperparameters to lead to very cluttered <code>ParamSet</code>s, or even for hyperparameter names to clash. <code>mlrCPO</code> has two remedies for that.</p>
<p>First, any <code>CPO</code> also has an <strong><code>id</code></strong> that is always prepended to the hyperparameter names. It can be set during construction, using the <code>id</code> parameter, or changed later using <code>setCPOId</code>. The latter one only works on primitive, i.e. not compound, <code>CPO</code>s. Set the <code>id</code> to <code>NULL</code> to use the <code>CPO</code>’s hyperparameters without a prefix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpo =<span class="st"> </span><span class="kw">cpoScale</span>(<span class="dt">id =</span> <span class="st">&quot;a&quot;</span>) %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>(<span class="dt">id =</span> <span class="st">&quot;b&quot;</span>)  <span class="co"># not very useful example</span>
<span class="kw">getHyperPars</span>(cpo)</code></pre></div>
<p>The second remedy against hyperparameter clashes is different “exports” of hyperparameters: The hyperparameters that can be changed using <code>setHyperPars</code>, i.e. that are <em>exported</em> by a <code>CPO</code>, are a subset of the parameters of the <code>CPOConstructor</code>. For each kind of <code>CPO</code>, there is a standard set of parameters that are exported, but during construction, it is possible to influence the parameters that actually get exported via the <code>export</code> parameter. <code>export</code> can be one of a set of standard export settings (among them “<code>export.all</code>” and “<code>export.none</code>”) or a <code>character</code> vector of the parameters to export.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpo =<span class="st"> </span><span class="kw">cpoPca</span>(<span class="dt">export =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;rank&quot;</span>))
<span class="kw">getParamSet</span>(cpo)</code></pre></div>
</div>
<div id="retrafo" class="section level2">
<h2>Retrafo</h2>
<p>Manipulating data for preprocessing itself is relatively easy. A challenge comes when one wants to integrate preprocessing into a machine-learning pipeline: The same preprocessing steps that are performed on the training data need to be performed on the new prediction data. However, the transformation performed for prediction often needs information from the training step. For example, if training entail performing PCA, then for prediction, the data must not undergo another PCA, instead it needs to be rotated by the <em>rotation matrix</em> found by the training PCA. The process of obtaining the rotation matrix will be called “training” the <code>CPO</code>, and the object that contains the trained information is called <code>CPOTrained</code>. For preprocessing operations that operate only on <em>features</em> of a task (as opposed to the target column), the <code>CPOTrained</code> will always be applied to new incoming data, and hence be of class <code>CPORetrafo</code> and called a “retrafo” object. To obtain this retrafo object, one can use <code>retrafo()</code>. Retrafo objects can be applied to data just as <code>CPO</code>s can, by using the <code>%&gt;&gt;%</code> operator.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">transformed =<span class="st"> </span>iris.demo %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>(<span class="dt">rank =</span> <span class="dv">3</span>)
transformed

ret =<span class="st"> </span><span class="kw">retrafo</span>(transformed)
ret</code></pre></div>
<p>To show that <code>ret</code> actually represents the exact same preprocessing operation, we can feed the first line of <code>iris.demo</code> back to it, to verify that the transformation is the same.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris.demo[<span class="dv">1</span>, ] %&gt;&gt;%<span class="st"> </span>ret</code></pre></div>
<p>Obviously we would not have gotten there by feeding the first line to <code>cpoPca</code> directly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris.demo[<span class="dv">1</span>, ] %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>(<span class="dt">rank =</span> <span class="dv">3</span>)</code></pre></div>
</div>
<div id="the-rest" class="section level2">
<h2>THE REST</h2>
<p>When attaching a <code>CPO</code> to a <code>Learner</code> using the <code>%&gt;&gt;%</code>-operator, all this is performed by <code>mlrCPO</code>, so there is no need to worry about keeping <code>CPOTrained</code> objects around.</p>
<p><code>retrafo()</code> gets the retrafo object from an attribute of the <code>transformed</code> object. The retrafo is always generated by the application of a <code>CPO</code> already. Retrafos that are attached to an object also stack, so multiple applications of different <code>CPO</code>s only need one <code>retrafo()</code> call to get the respective retrafo operation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trans.a =<span class="st"> </span>iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>()
trans.b =<span class="st"> </span>trans.a %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
ret =<span class="st"> </span><span class="kw">retrafo</span>(trans.b)</code></pre></div>
<p>Check that ‘ret’ does what it is supposed to do:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(trans.b)
<span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span>ret</code></pre></div>
<div id="tuning" class="section level3">
<h3>Tuning</h3>
<p>Since the hyperparameters remain intact for learners, is possible to tune hyperparameters parameters of preprocessing operations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">clrn =</span> <span class="kw">cpoModelMatrix</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.logreg&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getParamSet</span>(clrn)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ps =<span class="st"> </span><span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;model.matrix.formula&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">first =</span> ~<span class="dv">0</span> +<span class="st"> </span>., <span class="dt">second =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">2</span>, <span class="dt">third =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">3</span>)))

<span class="kw">tuneParams</span>(clrn, pid.task, cv5, <span class="dt">par.set =</span> ps,
           <span class="dt">control =</span> <span class="kw">makeTuneControlGrid</span>(),
           <span class="dt">show.info =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
</div>
<div id="special-cpos" class="section level2">
<h2>Special CPOs</h2>
<div id="cpo-multiplexer" class="section level3">
<h3>CPO Multiplexer</h3>
<p>The multiplexer makes it possible to combine many CPOs into one, with an extra <code>selected.cpo</code> parameter that chooses between them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpm =<span class="st"> </span><span class="kw">cpoMultiplex</span>(<span class="kw">list</span>(cpoScale, cpoPca))
<span class="kw">print</span>(cpm, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpm, <span class="dt">selected.cpo =</span> <span class="st">&quot;scale&quot;</span>))</code></pre></div>
<p>Every CPO’s Hyperparameters are exported:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpm, <span class="dt">selected.cpo =</span> <span class="st">&quot;scale&quot;</span>, <span class="dt">scale.center =</span> <span class="ot">FALSE</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpm, <span class="dt">selected.cpo =</span> <span class="st">&quot;pca&quot;</span>))</code></pre></div>
<p>This makes it possible to tune over many different tuner configurations at once.</p>
</div>
<div id="cpo-wrapper" class="section level3">
<h3>CPO Wrapper</h3>
<p>A simple CPO with one parameter which gets applied to the data as CPO. This is different from a multiplexer in that its parameter is free and can take any value that behaves like a CPO. On the downside, this does not expose the argument’s parameters to the outside.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpa =<span class="st"> </span><span class="kw">cpoWrap</span>()
<span class="kw">print</span>(cpa, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpa, <span class="dt">wrap.cpo =</span> <span class="kw">cpoScale</span>()))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpa, <span class="dt">wrap.cpo =</span> <span class="kw">cpoPca</span>()))</code></pre></div>
<p>Attaching the cpo applicator to a learner gives this learner a “cpo” hyperparameter that can be set to any CPO.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getParamSet</span>(<span class="kw">cpoWrap</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.logreg&quot;</span>))</code></pre></div>
</div>
<div id="cbind-cpo" class="section level3">
<h3>CBind CPO</h3>
<p><code>cbind</code> other CPOs as operation. The <code>cbinder</code> makes it possible to build DAGs of CPOs that perform different operations on data and paste the results next to each other.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scale =<span class="st"> </span><span class="kw">cpoScale</span>(<span class="dt">id =</span> <span class="st">&quot;scale&quot;</span>)
scale.pca =<span class="st"> </span>scale %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
cbinder =<span class="st"> </span><span class="kw">cpoCbind</span>(<span class="dt">scaled =</span> scale, <span class="dt">pcad =</span> scale.pca, <span class="dt">original =</span> NULLCPO)</code></pre></div>
<p><code>cpoCbind</code> recognises that <code>&quot;scale.scale&quot;</code> happens before <code>&quot;pca.pca&quot;</code> but is also fed to the result directly. The summary draws a (crude) ascii-art graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(cbinder)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getParamSet</span>(cbinder)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span>cbinder)</code></pre></div>
<p>The unnecessary copies of “Species” are unfortunate. Remove them with cpoSelect:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">selector =<span class="st"> </span><span class="kw">cpoSelect</span>(<span class="dt">type =</span> <span class="st">&quot;numeric&quot;</span>)
cbinder.select =<span class="st"> </span><span class="kw">cpoCbind</span>(<span class="dt">scaled =</span> selector %&gt;&gt;%<span class="st"> </span>scale, <span class="dt">pcad =</span> selector %&gt;&gt;%<span class="st"> </span>scale.pca, <span class="dt">original =</span> NULLCPO)
cbinder.select
<span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span>cbinder)</code></pre></div>
<p>alternatively, we apply the cbinder only to numerical data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoWrap</span>(cbinder, <span class="dt">affect.type =</span> <span class="st">&quot;numeric&quot;</span>))</code></pre></div>
</div>
</div>
<div id="custom-cpos" class="section level2">
<h2>Custom CPOs</h2>
<p>Even though <code>CPO</code>s are very flexible and can be combined in many ways, it may be necessary to create completely custom <code>CPO</code>s. Custom CPOs can be created using the <code>makeCPO</code> function. Its most important arguments are <code>cpo.trafo</code> and <code>cpo.retrafo</code>, both of which are functions. In principle, a <code>CPO</code> needs a function that “trains” a control object depending on the data (<code>cpo.trafo</code>), and another function that uses this control object, and new data, to perform the preprocessing operation (<code>cpo.retrafo</code>). The <code>cpo.trafo</code>-function must return a “control” object which contains all information about how to transform a given dataset. <code>cpo.retrafo</code> takes a (potentially new!) dataset <em>and</em> the “control” object returned by <code>cpo.trafo</code>, and transforms the new data according to plan.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(<span class="kw">formals</span>(makeCPO))  <span class="co"># see help(makeCPO) for explanation of arguments</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">constFeatRem =<span class="st"> </span><span class="kw">makeCPO</span>(<span class="st">&quot;constFeatRem&quot;</span>,  <span class="co"># nolint</span>
  <span class="dt">dataformat =</span> <span class="st">&quot;df.features&quot;</span>,
  <span class="dt">cpo.train =</span> function(data, target) {
    <span class="kw">names</span>(<span class="kw">Filter</span>(function(x) {  <span class="co"># names of columns to keep</span>
        <span class="kw">length</span>(<span class="kw">unique</span>(x)) &gt;<span class="st"> </span><span class="dv">1</span>
      }, data))
    }, <span class="dt">cpo.retrafo =</span> function(data, control) {
    data[control]
  })
<span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span><span class="kw">constFeatRem</span>()
<span class="kw">print</span>(constFeatRem, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="tuning-cpo" class="section level2">
<h2>Tuning CPO</h2>
<p>CPOs export their parameters when attached to a learner. Tuning of CPO-Learners works exactly as tuning for ordinary Learners.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">clrn =</span> <span class="kw">cpoModelMatrix</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.logreg&quot;</span>))
<span class="kw">getParamSet</span>(clrn)

ps =<span class="st"> </span><span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;model.matrix.formula&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">first =</span> ~<span class="dv">0</span> +<span class="st"> </span>., <span class="dt">second =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">2</span>, <span class="dt">third =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">3</span>)))

<span class="kw">tuneParams</span>(clrn, pid.task, cv5, <span class="dt">par.set =</span> ps,
           <span class="dt">control =</span> <span class="kw">makeTuneControlGrid</span>(),
           <span class="dt">show.info =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Tuning of CPOs and tuning of Learners can happen at the same time. The following is not executed to save build time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tlrn =<span class="st"> </span><span class="kw">cpoModelMatrix</span>() %&gt;&gt;%
<span class="st">       </span><span class="kw">cpoWrap</span>() %&gt;&gt;%
<span class="st">       </span><span class="kw">cpoFilterGainRatio</span>() %&gt;&gt;%
<span class="st">       </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.ctree&quot;</span>)
<span class="kw">sprintf</span>(<span class="st">&quot;Parameters: %s&quot;</span>, <span class="kw">paste</span>(<span class="kw">names</span>(<span class="kw">getParamSet</span>(tlrn)$pars), <span class="dt">collapse=</span><span class="st">&quot;, &quot;</span>))
ps2 =<span class="st"> </span><span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;model.matrix.formula&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">first =</span> ~<span class="dv">0</span> +<span class="st"> </span>., <span class="dt">second =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">2</span>)),
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;wrap.cpo&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">nopca =</span> NULLCPO,
                      <span class="dt">onlypca =</span> <span class="kw">cpoPca</span>(),
                      <span class="dt">addpca =</span> <span class="kw">cpoCbind</span>(NULLCPO, <span class="kw">cpoPca</span>()))),
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;gain.ratio.perc&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="fl">0.333</span>, <span class="fl">0.667</span>, <span class="fl">1.0</span>)),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;teststat&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;quad&quot;</span>, <span class="st">&quot;max&quot;</span>)))

<span class="kw">tuneParams</span>(tlrn, pid.task, cv5, <span class="dt">par.set =</span> ps2,
           <span class="dt">control =</span> <span class="kw">makeTuneControlGrid</span>())</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
