<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Martin Binder" />

<meta name="date" content="2017-12-25" />

<title>mlrCPO Core</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">mlrCPO Core</h1>
<h4 class="author"><em>Martin Binder</em></h4>
<h4 class="date"><em>2017-12-25</em></h4>



<div id="cpo-vignette-navigation" class="section level4">
<h4>CPO Vignette Navigation</h4>
<ol style="list-style-type: decimal">
<li><a href="a_1_getting_started.html">First Steps</a> (<a href="z_1_getting_started_terse.html">compact version</a>)</li>
<li>mlrCPO Core (<a href="z_2_mlrCPO_core_terse.html">compact version</a>)</li>
<li><a href="a_3_all_CPOs.html">CPOs Built Into mlrCPO</a> (<a href="z_3_all_CPOs_terse.html">compact version</a>)</li>
<li><a href="a_4_custom_CPOs.html">Building Custom CPOs</a> (<a href="z_4_custom_CPOs_terse.html">compact version</a>)</li>
</ol>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This vignette is supposed to be a short reference of the primitives and tools supplied by the <code>mlrCPO</code> package.</p>
</div>
<div id="lifecycle-of-a-cpo" class="section level2">
<h2>Lifecycle of a CPO</h2>
<p><strong>CPO</strong>s are first-class objects in R that represent data manipulation. They can be combined to form networks of operation, they can be attached to <code>mlr</code> <code>Learner</code>s, and they have tunable Hyperparameters that influence their behaviour. <code>CPO</code>s go through a lifecycle from construction to <code>CPO</code> to a <code>CPOTrained</code> “retrafo” or “inverter” object. The different stages of a <code>CPO</code> related object can be distinguished using <strong><code>getCPOClass()</code></strong>, which takes one of five values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getCPOClass</span>(cpoPca)
<span class="co">#&gt; [1] &quot;CPOConstructor&quot;</span>
<span class="kw">getCPOClass</span>(<span class="kw">cpoPca</span>())
<span class="co">#&gt; [1] &quot;CPO&quot;</span>
<span class="kw">getCPOClass</span>(pid.task %&gt;|%<span class="st"> </span><span class="kw">cpoPca</span>())
<span class="co">#&gt; [1] &quot;CPORetrafo&quot;</span>
<span class="kw">getCPOClass</span>(<span class="kw">inverter</span>(bh.task %&gt;&gt;%<span class="st"> </span><span class="kw">cpoLogTrafoRegr</span>()))
<span class="co">#&gt; [1] &quot;CPOInverter&quot;</span>
<span class="kw">getCPOClass</span>(NULLCPO)
<span class="co">#&gt; [1] &quot;NULLCPO&quot;</span></code></pre></div>
</div>
<div id="cpoconstructor" class="section level2">
<h2>CPOConstructor</h2>
<p><code>CPO</code>s are created using <strong><code>CPOConstructor</code></strong>s. These are R functions with a print function and many parameters in common.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(cpoAsNumeric)  <span class="co"># example CPOConstructor</span>
<span class="co">#&gt; &lt;&lt;CPO as.numeric()&gt;&gt;</span>
<span class="kw">print</span>(cpoAsNumeric, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)  <span class="co"># alternative: !cpoAsNumeric</span>
<span class="co">#&gt; &lt;&lt;CPO as.numeric()&gt;&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; cpo.retrafo:</span>
<span class="co">#&gt; function(data) {</span>
<span class="co">#&gt;       as.data.frame(lapply(data, as.numeric), row.names = rownames(data)) }</span>
<span class="co">#&gt; &lt;environment: namespace:mlrCPO&gt;</span>
<span class="kw">class</span>(cpoAsNumeric)
<span class="co">#&gt; [1] &quot;CPOConstructor&quot; &quot;function&quot;</span>
<span class="kw">getCPOName</span>(cpoPca)  <span class="co"># same as getCPOName() of the *constructed* CPO</span>
<span class="co">#&gt; [1] &quot;pca&quot;</span>
<span class="kw">getCPOClass</span>(cpoPca)
<span class="co">#&gt; [1] &quot;CPOConstructor&quot;</span></code></pre></div>
<p>The function parameters of a <code>CPOConstructor</code></p>
<ul>
<li>set the <code>CPO</code> Hyperparameters</li>
<li>set the <code>CPO</code> <code>id</code> (default to the <code>CPO</code>’s <code>name</code>)</li>
<li>resetrict the data columns a CPO operates on (<code>affect.*</code> parameters)</li>
<li>control which of the <code>CPO</code>’s hyperparameters are “exported”, i.e. can late be manipulated using <code>setHyperPars()</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(<span class="kw">formals</span>(cpoPca))
<span class="co">#&gt;  [1] &quot;center&quot;                     &quot;scale&quot;                     </span>
<span class="co">#&gt;  [3] &quot;tol&quot;                        &quot;rank&quot;                      </span>
<span class="co">#&gt;  [5] &quot;id&quot;                         &quot;export&quot;                    </span>
<span class="co">#&gt;  [7] &quot;affect.type&quot;                &quot;affect.index&quot;              </span>
<span class="co">#&gt;  [9] &quot;affect.names&quot;               &quot;affect.pattern&quot;            </span>
<span class="co">#&gt; [11] &quot;affect.invert&quot;              &quot;affect.pattern.ignore.case&quot;</span>
<span class="co">#&gt; [13] &quot;affect.pattern.perl&quot;        &quot;affect.pattern.fixed&quot;</span></code></pre></div>
<div id="cpo" class="section level3">
<h3>CPO</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">cpo =</span> <span class="kw">cpoScale</span>()) <span class="co"># construct CPO with default Hyperparameter values</span>
<span class="co">#&gt; scale(center = TRUE, scale = TRUE)</span>
<span class="kw">print</span>(cpo, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)  <span class="co"># detailed printing. Alternative: !cpo</span>
<span class="co">#&gt; Trafo chain of 1 cpos:</span>
<span class="co">#&gt; scale(center = TRUE, scale = TRUE)</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt;                 Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; scale.center logical   - TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; scale.scale  logical   - TRUE      -   -    TRUE     -</span>
<span class="kw">class</span>(cpo)  <span class="co"># CPOs that are not compound are &quot;CPOPrimitive&quot;</span>
<span class="co">#&gt; [1] &quot;CPOPrimitive&quot; &quot;CPO&quot;</span>
<span class="kw">getCPOClass</span>(cpo)
<span class="co">#&gt; [1] &quot;CPO&quot;</span></code></pre></div>
</div>
<div id="functions-that-work-on-cpos" class="section level3">
<h3>Functions that work on CPOs</h3>
<p>The inner “state” of a <code>CPO</code> can be inspected and manipulated using various getters and setters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getParamSet</span>(cpo)
<span class="co">#&gt;                 Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; scale.center logical   - TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; scale.scale  logical   - TRUE      -   -    TRUE     -</span>
<span class="kw">getHyperPars</span>(cpo)
<span class="co">#&gt; $scale.center</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scale.scale</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">setHyperPars</span>(cpo, <span class="dt">scale.center =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; scale(center = FALSE, scale = TRUE)</span>
<span class="kw">getCPOId</span>(cpo)
<span class="co">#&gt; [1] &quot;scale&quot;</span>
<span class="kw">setCPOId</span>(cpo, <span class="st">&quot;MYID&quot;</span>)
<span class="co">#&gt; MYID&lt;scale&gt;(center = TRUE, scale = TRUE)</span>
<span class="kw">getCPOName</span>(cpo)
<span class="co">#&gt; [1] &quot;scale&quot;</span>
<span class="kw">getCPOAffect</span>(cpo)  <span class="co"># empty, since no affect set</span>
<span class="co">#&gt; named list()</span>
<span class="kw">getCPOAffect</span>(<span class="kw">cpoPca</span>(<span class="dt">affect.pattern =</span> <span class="st">&quot;Width$&quot;</span>))
<span class="co">#&gt; $pattern</span>
<span class="co">#&gt; [1] &quot;Width$&quot;</span>
<span class="kw">getCPOConstructor</span>(cpo)  <span class="co"># the constructor used to create the CPO</span>
<span class="co">#&gt; &lt;&lt;CPO scale(center = TRUE, scale = TRUE)&gt;&gt;</span>
<span class="kw">getCPOProperties</span>(cpo)  <span class="co"># see properties explanation below</span>
<span class="co">#&gt; $handling</span>
<span class="co">#&gt;  [1] &quot;numerics&quot;   &quot;factors&quot;    &quot;ordered&quot;    &quot;missings&quot;   &quot;cluster&quot;   </span>
<span class="co">#&gt;  [6] &quot;classif&quot;    &quot;multilabel&quot; &quot;regr&quot;       &quot;surv&quot;       &quot;oneclass&quot;  </span>
<span class="co">#&gt; [11] &quot;twoclass&quot;   &quot;multiclass&quot; &quot;prob&quot;       &quot;se&quot;        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $adding</span>
<span class="co">#&gt; character(0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $needed</span>
<span class="co">#&gt; character(0)</span>
<span class="kw">getCPOPredictType</span>(cpo)
<span class="co">#&gt;   response       prob         se </span>
<span class="co">#&gt; &quot;response&quot;     &quot;prob&quot;       &quot;se&quot;</span>
<span class="kw">getCPOOperatingType</span>(cpo)  <span class="co"># Operating on feature, target, retrafoless?</span>
<span class="co">#&gt; [1] &quot;feature&quot;</span></code></pre></div>
<p>Compare the predict type and operating type of a TOCPO or ROCPO:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getCPOPredictType</span>(<span class="kw">cpoResponseFromSE</span>())
<span class="co">#&gt; response       se </span>
<span class="co">#&gt;     &quot;se&quot;     &quot;se&quot;</span>
<span class="kw">getCPOOperatingType</span>(<span class="kw">cpoResponseFromSE</span>())
<span class="co">#&gt; [1] &quot;target&quot;</span>
<span class="kw">getCPOOperatingType</span>(<span class="kw">cpoSample</span>())
<span class="co">#&gt; [1] &quot;retrafoless&quot;</span></code></pre></div>
</div>
<div id="exporting-parameters" class="section level3">
<h3>Exporting Parameters</h3>
<p>Sometimes when using many CPOs, their hyperparameters may get messy. <code>mlrCPO</code> enables the user to control which hyperparameter get exported. The parameter “export” can be one of <code>&quot;export.default&quot;</code>, <code>&quot;export.set&quot;</code>, <code>&quot;export.unset&quot;</code>, <code>&quot;export.default.set&quot;</code>, <code>&quot;export.default.unset&quot;</code>, <code>&quot;export.all&quot;</code>, <code>&quot;export.none&quot;</code>. “all” and “none” do what one expects; “default” exports the “recommended” parameters; “set” and “unset” export the values that have not been set, or only the values that were set (and are not left as default). “default.set” and “default.unset” work as “set” and “unset”, but restricted to the default exported parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">!<span class="kw">cpoScale</span>()
<span class="co">#&gt; Trafo chain of 1 cpos:</span>
<span class="co">#&gt; scale(center = TRUE, scale = TRUE)</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt;                 Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; scale.center logical   - TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; scale.scale  logical   - TRUE      -   -    TRUE     -</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">!<span class="kw">cpoScale</span>(<span class="dt">export =</span> <span class="st">&quot;export.none&quot;</span>)
<span class="co">#&gt; Trafo chain of 1 cpos:</span>
<span class="co">#&gt; scale()[not exp'd: center = TRUE, scale = TRUE]</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt; [1] &quot;Empty parameter set.&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">!<span class="kw">cpoScale</span>(<span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">export =</span> <span class="st">&quot;export.unset&quot;</span>)
<span class="co">#&gt; Trafo chain of 1 cpos:</span>
<span class="co">#&gt; scale(center = TRUE)[not exp'd: scale = FALSE]</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt;                 Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; scale.center logical   - TRUE      -   -    TRUE     -</span></code></pre></div>
</div>
<div id="cpo-application-using-or-applycpo" class="section level3">
<h3>CPO Application using <code>%&gt;&gt;%</code> or <code>applyCPO</code></h3>
<p><code>CPO</code>s can be applied to <code>data.frame</code> and <code>Task</code> objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
<span class="co">#&gt;   Species        PC1          PC2         PC3           PC4</span>
<span class="co">#&gt; 1  setosa -0.1634147  0.017230444 -0.11038321 -0.0231625616</span>
<span class="co">#&gt; 2  setosa  0.3324970 -0.189351624 -0.08152883  0.0005612917</span>
<span class="co">#&gt; 3  setosa  0.3268659  0.101103375 -0.02238439  0.0464537730</span>
<span class="co">#&gt; 4  setosa  0.4202367  0.005523981  0.17106514 -0.0222757931</span>
<span class="co">#&gt; 5  setosa -0.1768684  0.140149101 -0.04185224 -0.0194870755</span>
<span class="co">#&gt; 6  setosa -0.7393165 -0.074655279  0.08508352  0.0179103657</span>
task =<span class="st"> </span><span class="kw">applyCPO</span>(<span class="kw">cpoPca</span>(), iris.task)
<span class="kw">head</span>(<span class="kw">getTaskData</span>(task))
<span class="co">#&gt;   Species       PC1        PC2         PC3          PC4</span>
<span class="co">#&gt; 1  setosa -2.684126 -0.3193972  0.02791483  0.002262437</span>
<span class="co">#&gt; 2  setosa -2.714142  0.1770012  0.21046427  0.099026550</span>
<span class="co">#&gt; 3  setosa -2.888991  0.1449494 -0.01790026  0.019968390</span>
<span class="co">#&gt; 4  setosa -2.745343  0.3182990 -0.03155937 -0.075575817</span>
<span class="co">#&gt; 5  setosa -2.728717 -0.3267545 -0.09007924 -0.061258593</span>
<span class="co">#&gt; 6  setosa -2.280860 -0.7413304 -0.16867766 -0.024200858</span></code></pre></div>
</div>
<div id="cpo-composition-using-or-composecpo" class="section level3">
<h3>CPO Composition using <code>%&gt;&gt;%</code> or <code>composeCPO</code></h3>
<p><code>CPO</code> composition results in a new CPO which mostly behaves like a primitive CPO. Exceptions are:</p>
<ul>
<li>Compound CPOs have no <code>id</code></li>
<li>Affect of compound CPOs cannot be retrieved</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scale1 =<span class="st"> </span><span class="kw">cpoScale</span>()
scale2 =<span class="st"> </span><span class="kw">cpoScale</span>()</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scale1 %&gt;&gt;%<span class="st"> </span>scale2  <span class="co"># error! parameters 'center' and 'scale' occur in both</span>
<span class="co">#&gt; Error in parameterClashAssert(cpo1, cpo2, cpo1$debug.name, cpo2$debug.name): Parameters &quot;scale.center&quot;, &quot;scale.scale&quot; occur in both scale and scale</span>
<span class="co">#&gt; Use the id parameter when constructing, or setCPOId, to prevent name collisions.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compound =<span class="st"> </span><span class="kw">setCPOId</span>(scale1, <span class="st">&quot;scale1&quot;</span>) %&gt;&gt;%<span class="st"> </span><span class="kw">setCPOId</span>(scale2, <span class="st">&quot;scale2&quot;</span>)
<span class="kw">composeCPO</span>(<span class="kw">setCPOId</span>(scale1, <span class="st">&quot;scale1&quot;</span>), <span class="kw">setCPOId</span>(scale2, <span class="st">&quot;scale2&quot;</span>))  <span class="co"># same</span>
<span class="co">#&gt; (scale1&lt;scale&gt; &gt;&gt; scale2&lt;scale&gt;)(scale1.center = TRUE, scale1.scale = TRUE, scale2.center = TRUE, scale2.scale = TRUE)</span>
<span class="kw">class</span>(compound)
<span class="co">#&gt; [1] &quot;CPOPipeline&quot; &quot;CPO&quot;</span>
!compound
<span class="co">#&gt; Trafo chain of 2 cpos:</span>
<span class="co">#&gt; scale1&lt;scale&gt;(center = TRUE, scale = TRUE)</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt;                  Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; scale1.center logical   - TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; scale1.scale  logical   - TRUE      -   -    TRUE     -</span>
<span class="co">#&gt;   ====&gt;</span>
<span class="co">#&gt; scale2&lt;scale&gt;(center = TRUE, scale = TRUE)</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt;                  Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; scale2.center logical   - TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; scale2.scale  logical   - TRUE      -   -    TRUE     -</span>
<span class="kw">getCPOName</span>(compound)
<span class="co">#&gt; [1] &quot;scale.scale&quot;</span>
<span class="kw">getHyperPars</span>(compound)
<span class="co">#&gt; $scale1.center</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scale1.scale</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scale2.center</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scale2.scale</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">setHyperPars</span>(compound, <span class="dt">scale1.center =</span> <span class="ot">TRUE</span>, <span class="dt">scale2.center =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; (scale1&lt;scale&gt; &gt;&gt; scale2&lt;scale&gt;)(scale1.center = TRUE, scale1.scale = TRUE, scale2.center = FALSE, scale2.scale = TRUE)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getCPOId</span>(compound)  <span class="co"># error: no ID for compound CPOs</span>
<span class="co">#&gt; Error in getCPOId.CPO(compound): Compound CPOs have no IDs.</span>
<span class="kw">getCPOAffect</span>(compound)  <span class="co"># error: no affect for compound CPOs</span>
<span class="co">#&gt; Error in getCPOAffect.CPO(compound): Compound CPOs have no affect arguments.</span></code></pre></div>
<p><code>getCPOOperatingType()</code> always considers the operating type of the whole <code>CPO</code> chain and may return multiple values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getCPOOperatingType</span>(NULLCPO)
<span class="co">#&gt; character(0)</span>
<span class="kw">getCPOOperatingType</span>(<span class="kw">cpoScale</span>())
<span class="co">#&gt; [1] &quot;feature&quot;</span>
<span class="kw">getCPOOperatingType</span>(<span class="kw">cpoScale</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">cpoLogTrafoRegr</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">cpoSample</span>())
<span class="co">#&gt; [1] &quot;feature&quot;     &quot;target&quot;      &quot;retrafoless&quot;</span></code></pre></div>
</div>
<div id="compound-cpo-decomposition-cpo-chaining" class="section level3">
<h3>Compound CPO decomposition, CPO chaining</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.list</span>(compound)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; scale1&lt;scale&gt;(center = TRUE, scale = TRUE)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; scale2&lt;scale&gt;(center = TRUE, scale = TRUE)</span>
<span class="kw">pipeCPO</span>(<span class="kw">as.list</span>(compound))  <span class="co"># chainCPO: (list of CPO) -&gt; CPO</span>
<span class="co">#&gt; (scale1&lt;scale&gt; &gt;&gt; scale2&lt;scale&gt;)(scale1.center = TRUE, scale1.scale = TRUE, scale2.center = TRUE, scale2.scale = TRUE)</span>
<span class="kw">pipeCPO</span>(<span class="kw">list</span>())
<span class="co">#&gt; NULLCPO</span></code></pre></div>
</div>
</div>
<div id="cpolearner-cpo---learner-attachment-using-or-attachcpo" class="section level2">
<h2>CPOLearner: CPO - Learner attachment using <code>%&gt;&gt;%</code> or <code>attachCPO</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lrn =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.logreg&quot;</span>)
(<span class="dt">cpolrn =</span> cpo %&gt;&gt;%<span class="st"> </span>lrn)  <span class="co"># the new learner has the CPO hyperparameters</span>
<span class="co">#&gt; Learner classif.logreg.scale from package stats</span>
<span class="co">#&gt; Type: classif</span>
<span class="co">#&gt; Name: ; Short name: </span>
<span class="co">#&gt; Class: CPOLearner</span>
<span class="co">#&gt; Properties: numerics,factors,twoclass,prob</span>
<span class="co">#&gt; Predict-Type: response</span>
<span class="co">#&gt; Hyperparameters: model=FALSE</span>
<span class="kw">attachCPO</span>(compound, lrn)  <span class="co"># attaching compound CPO</span>
<span class="co">#&gt; Learner classif.logreg.scale.scale from package stats</span>
<span class="co">#&gt; Type: classif</span>
<span class="co">#&gt; Name: ; Short name: </span>
<span class="co">#&gt; Class: CPOLearner</span>
<span class="co">#&gt; Properties: numerics,factors,twoclass,prob</span>
<span class="co">#&gt; Predict-Type: response</span>
<span class="co">#&gt; Hyperparameters: model=FALSE</span></code></pre></div>
<p>The new object is a <code>CPOLearner</code>, which performs the operation given by the <code>CPO</code> before trainign the <code>Learner</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(lrn)
<span class="co">#&gt; [1] &quot;classif.logreg&quot;  &quot;RLearnerClassif&quot; &quot;RLearner&quot;        &quot;Learner&quot;</span></code></pre></div>
<p>The work performed by a <code>CPOLearner</code> can also be performed manually:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lrn =<span class="st"> </span><span class="kw">cpoLogTrafoRegr</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;regr.lm&quot;</span>)
model =<span class="st"> </span><span class="kw">train</span>(lrn, <span class="kw">subsetTask</span>(bh.task, <span class="dv">1</span>:<span class="dv">300</span>))
<span class="kw">predict</span>(model, <span class="kw">subsetTask</span>(bh.task, <span class="dv">301</span>:<span class="dv">500</span>))
<span class="co">#&gt; Prediction: 200 observations</span>
<span class="co">#&gt; predict.type: response</span>
<span class="co">#&gt; threshold: </span>
<span class="co">#&gt;     id truth response</span>
<span class="co">#&gt; 301  1  24.8 28.69715</span>
<span class="co">#&gt; 302  2  22.0 27.89821</span>
<span class="co">#&gt; 303  3  26.4 28.33370</span>
<span class="co">#&gt; 304  4  33.1 33.80868</span>
<span class="co">#&gt; 305  5  36.1 34.93957</span>
<span class="co">#&gt; 306  6  28.4 28.77130</span>
<span class="co">#&gt; ... (#rows: 200, #cols: 3)</span></code></pre></div>
<p>is equivalent to</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trafo =<span class="st"> </span><span class="kw">subsetTask</span>(bh.task, <span class="dv">1</span>:<span class="dv">300</span>) %&gt;&gt;%<span class="st"> </span><span class="kw">cpoLogTrafoRegr</span>()
model =<span class="st"> </span><span class="kw">train</span>(<span class="st">&quot;regr.lm&quot;</span>, trafo)

newdata =<span class="st"> </span><span class="kw">subsetTask</span>(bh.task, <span class="dv">301</span>:<span class="dv">500</span>) %&gt;&gt;%<span class="st"> </span><span class="kw">retrafo</span>(trafo)
pred =<span class="st"> </span><span class="kw">predict</span>(model, newdata)
<span class="kw">invert</span>(<span class="kw">inverter</span>(newdata), pred)
<span class="co">#&gt; Prediction: 200 observations</span>
<span class="co">#&gt; predict.type: response</span>
<span class="co">#&gt; threshold: </span>
<span class="co">#&gt;     id truth response</span>
<span class="co">#&gt; 301  1  24.8 28.69715</span>
<span class="co">#&gt; 302  2  22.0 27.89821</span>
<span class="co">#&gt; 303  3  26.4 28.33370</span>
<span class="co">#&gt; 304  4  33.1 33.80868</span>
<span class="co">#&gt; 305  5  36.1 34.93957</span>
<span class="co">#&gt; 306  6  28.4 28.77130</span>
<span class="co">#&gt; ... (#rows: 200, #cols: 3)</span></code></pre></div>
<p>CPO learner decomposition</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getLearnerCPO</span>(cpolrn)  <span class="co"># the CPO</span>
<span class="co">#&gt; scale(center = TRUE, scale = TRUE)</span>
<span class="kw">getLearnerBare</span>(cpolrn)  <span class="co"># the Learner</span>
<span class="co">#&gt; Learner classif.logreg from package stats</span>
<span class="co">#&gt; Type: classif</span>
<span class="co">#&gt; Name: Logistic Regression; Short name: logreg</span>
<span class="co">#&gt; Class: classif.logreg</span>
<span class="co">#&gt; Properties: twoclass,numerics,factors,prob,weights</span>
<span class="co">#&gt; Predict-Type: response</span>
<span class="co">#&gt; Hyperparameters: model=FALSE</span></code></pre></div>
<div id="cpotrained" class="section level3">
<h3>CPOTrained</h3>
<p>CPOs perform data-dependent operation. However, when this operation becomes part of a machine-learning process, the operation on predict-data must depend only on the training data. A <code>CPORetrafo</code> object represents the re-application of a trained CPO. A <code>CPOInverter</code> object represents the transformation of a prediction made on a transformed task back to the form of the original data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">transformed =<span class="st"> </span>iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>()
<span class="kw">head</span>(transformed)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667  setosa</span>
(<span class="dt">ret =</span> <span class="kw">retrafo</span>(transformed))
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">getTaskTargets</span>(bh.task))
<span class="co">#&gt; [1] 24.0 21.6 34.7 33.4 36.2 28.7</span>
transformed =<span class="st"> </span>bh.task %&gt;&gt;%<span class="st"> </span><span class="kw">cpoLogTrafoRegr</span>()
<span class="kw">head</span>(<span class="kw">getTaskTargets</span>(transformed))
<span class="co">#&gt; [1] 3.178054 3.072693 3.546740 3.508556 3.589059 3.356897</span>
(<span class="dt">inv =</span> <span class="kw">inverter</span>(transformed))
<span class="co">#&gt; CPO Inverter chain {type:regr} (able to predict 'response', 'se')</span>
<span class="co">#&gt; [INVERTER fun.apply.regr.target(){type:regr}]</span>
<span class="kw">head</span>(<span class="kw">invert</span>(inv, <span class="kw">getTaskTargets</span>(transformed)))
<span class="co">#&gt; [1] 24.0 21.6 34.7 33.4 36.2 28.7</span></code></pre></div>
<div id="functions-that-work-on-cpotrained" class="section level4">
<h4>Functions that work on CPOTrained</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># General methods that work on retrafo</span>
<span class="kw">getCPOName</span>(ret)
<span class="co">#&gt; [1] &quot;scale&quot;</span>
<span class="kw">getHyperPars</span>(ret)
<span class="co">#&gt; $center</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scale</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">getCPOClass</span>(ret)
<span class="co">#&gt; [1] &quot;CPORetrafo&quot;</span>
<span class="kw">getCPOClass</span>(inv)
<span class="co">#&gt; [1] &quot;CPOInverter&quot;</span>
<span class="kw">getCPOOperatingType</span>(ret)  <span class="co"># Operating on feature, target, both?</span>
<span class="co">#&gt; [1] &quot;feature&quot;</span>
<span class="kw">getCPOOperatingType</span>(inv)
<span class="co">#&gt; [1] &quot;target&quot;</span>
<span class="kw">getCPOPredictType</span>(ret)
<span class="co">#&gt;   response       prob         se </span>
<span class="co">#&gt; &quot;response&quot;     &quot;prob&quot;       &quot;se&quot;</span>
<span class="kw">getCPOPredictType</span>(inv)
<span class="co">#&gt;   response         se </span>
<span class="co">#&gt; &quot;response&quot;       &quot;se&quot;</span></code></pre></div>
<p>A <code>CPOTrained</code> has information about whether it can be used as a <code>CPORetrafo</code> object (and be applied to new data using <code>%&gt;&gt;%</code>), or as a <code>CPOInverter</code> object (and used by <code>invert()</code>), or possibly both. This is given by <code>getCPOTrainedCapability()</code>, which returns a <code>1</code> if the object has an effect in the given role, <code>0</code> if the object has no effect (but can be used), or <code>-1</code> if the object can not be used in the role.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getCPOTrainedCapability</span>(ret)
<span class="co">#&gt; retrafo  invert </span>
<span class="co">#&gt;       1       0</span>
<span class="kw">getCPOTrainedCapability</span>(inv)
<span class="co">#&gt; retrafo  invert </span>
<span class="co">#&gt;      -1       1</span>
<span class="kw">getCPOTrainedCapability</span>(NULLCPO)
<span class="co">#&gt; retrafo  invert </span>
<span class="co">#&gt;       0       0</span></code></pre></div>
<p>Retrafos and inverters are stored as attributes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attributes</span>(transformed)
<span class="co">#&gt; $names</span>
<span class="co">#&gt; [1] &quot;type&quot;      &quot;env&quot;       &quot;weights&quot;   &quot;blocking&quot;  &quot;task.desc&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] &quot;RegrTask&quot;       &quot;SupervisedTask&quot; &quot;Task&quot;          </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $retrafo</span>
<span class="co">#&gt; CPO Retrafo / Inverter chain {type:regr} (able to predict 'response', 'se')</span>
<span class="co">#&gt; [RETRAFO fun.apply.regr.target(){type:regr}]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $inverter</span>
<span class="co">#&gt; CPO Inverter chain {type:regr} (able to predict 'response', 'se')</span>
<span class="co">#&gt; [INVERTER fun.apply.regr.target(){type:regr}]</span></code></pre></div>
</div>
<div id="cpotrained-inspection" class="section level4">
<h4>CPOTrained Inspection</h4>
<p><code>CPOTrained</code> objects can be inspected using <code>getCPOTrainedState()</code>. The state contains the hyperparameters, the <code>control</code> object (CPO dependent data representing the data information needed to re-apply the operation), and information about the <code>Task</code> / <code>data.frame</code> layout used for training (column names, column types) in <code>data$shapeinfo.input</code> and <code>data$shapeinfo.output</code>.</p>
<p>The state can be manipulated and used to create new <code>CPOTrained</code>s, using <code>makeCPOTrainedFromState()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">state =</span> <span class="kw">getCPOTrainedState</span>(<span class="kw">retrafo</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>())))
<span class="co">#&gt; $center</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scale</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $control</span>
<span class="co">#&gt; $control$center</span>
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span>
<span class="co">#&gt;     5.843333     3.057333     3.758000     1.199333 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $control$scale</span>
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span>
<span class="co">#&gt;    0.8280661    0.4358663    1.7652982    0.7622377 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data</span>
<span class="co">#&gt; $data$shapeinfo.input</span>
<span class="co">#&gt; &lt;ShapeInfo (input) Sepal.Length: num, Sepal.Width: num, Petal.Length: num, Petal.Width: num, Species: fac&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data$shapeinfo.output</span>
<span class="co">#&gt; &lt;ShapeInfo (output)&gt;:</span>
<span class="co">#&gt; numeric:</span>
<span class="co">#&gt; &lt;ShapeInfo Sepal.Length: num, Sepal.Width: num, Petal.Length: num, Petal.Width: num&gt;</span>
<span class="co">#&gt; factor:</span>
<span class="co">#&gt; &lt;ShapeInfo Species: fac&gt;</span>
<span class="co">#&gt; other:</span>
<span class="co">#&gt; &lt;ShapeInfo (empty)&gt;</span>
state$control$center[<span class="dv">1</span>] =<span class="st"> </span><span class="dv">1000</span>  <span class="co"># will now subtract 1000 from the first column</span>
new.retrafo =<span class="st"> </span><span class="kw">makeCPOTrainedFromState</span>(cpoScale, state)
<span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span>new.retrafo)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1    -1201.474  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2    -1201.716 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3    -1201.957  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4    -1202.078  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5    -1201.595  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6    -1201.112  1.93331463    -1.165809   -1.048667  setosa</span></code></pre></div>
</div>
<div id="application-of-cporetrafo-using-applycpo-or-predict" class="section level4">
<h4>Application of CPORetrafo using <code>%&gt;&gt;%</code>, <code>applyCPO</code>, or <code>predict</code></h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">transformed =<span class="st"> </span>iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>()
<span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span><span class="kw">retrafo</span>(transformed)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667  setosa</span></code></pre></div>
<p>Should in general give the same as <code>head(transformed)</code>, since the same data was used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(transformed)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667  setosa</span></code></pre></div>
<p><strong><code>applyCPO()</code></strong> and <strong><code>predict()</code></strong> are synonyms of <code>%&gt;&gt;%</code> when used for <code>CPORetrafo</code> objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">applyCPO</span>(<span class="kw">retrafo</span>(transformed), <span class="kw">head</span>(iris))
<span class="kw">predict</span>(<span class="kw">retrafo</span>(transformed), <span class="kw">head</span>(iris))</code></pre></div>
</div>
<div id="retrafos-are-automatically-chained-when-applying-cpos" class="section level4">
<h4>Retrafos are automatically chained when applying CPOs (!!!)</h4>
<p>When executing <code>data %&gt;&gt;% CPO</code>, the result has an associated <code>CPORetrafo</code> and <code>CPOInverter</code> object. When applying another <code>CPO</code>, the <code>CPORetrafo</code> and <code>CPOInverter</code> will be chained automatically. This is to make <code>(data %&gt;&gt;% CPO1) %&gt;&gt;% CPO2</code> work the same as <code>data %&gt;&gt;% (CPO1 %&gt;&gt;% CPO2)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data =<span class="st"> </span><span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
<span class="kw">retrafo</span>(data)
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO pca(center = TRUE, scale = FALSE)]</span>
data2 =<span class="st"> </span>data %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>()</code></pre></div>
<p><code>retrafo(data2)</code> is the same as <code>retrafo(data %&gt;&gt;% pca %&gt;&gt;% scale)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">retrafo</span>(data2)
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO pca(center = TRUE, scale = FALSE)] =&gt;</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span></code></pre></div>
<p>To interrupt this chain, set retrafo to <code>NULL</code> either explicitly, or using <code>clearRI()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data =<span class="st"> </span><span class="kw">clearRI</span>(data)
data2 =<span class="st"> </span>data %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>()
<span class="kw">retrafo</span>(data2)
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span></code></pre></div>
<p>this is equivalent to</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">retrafo</span>(data) =<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">inverter</span>(data) =<span class="st"> </span><span class="ot">NULL</span>
data3 =<span class="st"> </span>data %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>()
<span class="kw">retrafo</span>(data3)
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span></code></pre></div>
</div>
<div id="cpotrained-composition-decomposition-chaining" class="section level4">
<h4>CPOTrained Composition, Decomposition, Chaining</h4>
<p>Using <code>as.list</code> and <code>pipeCPO</code>, just like for <code>CPO</code>s.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compound.retrafo =<span class="st"> </span><span class="kw">retrafo</span>(<span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span>compound)
compound.retrafo
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)] =&gt;</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">retrafolist =</span> <span class="kw">as.list</span>(compound.retrafo))
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">retrafolist[[<span class="dv">1</span>]] %&gt;&gt;%<span class="st"> </span>retrafolist[[<span class="dv">2</span>]]
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)] =&gt;</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span>
<span class="kw">pipeCPO</span>(retrafolist)
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)] =&gt;</span>
<span class="co">#&gt; [RETRAFO scale(center = TRUE, scale = TRUE)]</span></code></pre></div>
</div>
</div>
</div>
<div id="cpo-properties" class="section level2">
<h2>CPO Properties</h2>
<p>CPOs contain information about the kind of data they can work with, and what kind of data they produce. <code>getCPOProperties</code> returns a list with the slots <code>handling</code>, <code>adding</code>, <code>needed</code>. <code>properties$handling</code> indicates the kind of data a CPO can handle, <code>properties$needed</code> indicates the kind of data it needs the data receiver (e.g. attached learner) to have, and <code>properties$adding</code> lists the properties it adds to a given learner. An example is <code>cpoDummyEncode()</code>, a CPO that converts factors to numerics: The receiving learner needs to handle numerics, so <code>properties$needed == &quot;numerics&quot;</code>, but it <em>adds</em> the ability to handle factors (since they are converted), so <code>properties$adding = c(&quot;factors&quot;, &quot;ordered&quot;)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getCPOProperties</span>(<span class="kw">cpoDummyEncode</span>())
<span class="co">#&gt; $handling</span>
<span class="co">#&gt;  [1] &quot;numerics&quot;   &quot;factors&quot;    &quot;ordered&quot;    &quot;missings&quot;   &quot;cluster&quot;   </span>
<span class="co">#&gt;  [6] &quot;classif&quot;    &quot;multilabel&quot; &quot;regr&quot;       &quot;surv&quot;       &quot;oneclass&quot;  </span>
<span class="co">#&gt; [11] &quot;twoclass&quot;   &quot;multiclass&quot; &quot;prob&quot;       &quot;se&quot;        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $adding</span>
<span class="co">#&gt; [1] &quot;factors&quot; &quot;ordered&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $needed</span>
<span class="co">#&gt; [1] &quot;numerics&quot;</span></code></pre></div>
<p>As a result, <code>cpoDummyEncode</code> endows a <code>Learner</code> with the ability to train on data with factor variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">train</span>(<span class="st">&quot;classif.geoDA&quot;</span>, bc.task)  <span class="co"># gives an error</span>
<span class="co">#&gt; Error in checkLearnerBeforeTrain(task, learner, weights): Task 'BreastCancer_example' has factor inputs in 'Cl.thickness, Cell.size, Cell.shape, Marg.adhes...', but learner 'classif.geoDA' does not support that!</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">train</span>(<span class="kw">cpoDummyEncode</span>(<span class="dt">reference.cat =</span> <span class="ot">TRUE</span>) %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.geoDA&quot;</span>), bc.task)
<span class="co">#&gt; Model for learner.id=classif.geoDA.dummyencode; learner.class=CPOLearner</span>
<span class="co">#&gt; Trained on: task.id = BreastCancer_example; obs = 683; features = 9</span>
<span class="co">#&gt; Hyperparameters: validation=NULL</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getLearnerProperties</span>(<span class="st">&quot;classif.geoDA&quot;</span>)
<span class="co">#&gt; [1] &quot;twoclass&quot;   &quot;multiclass&quot; &quot;numerics&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getLearnerProperties</span>(<span class="kw">cpoDummyEncode</span>(<span class="ot">TRUE</span>) %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.geoDA&quot;</span>))
<span class="co">#&gt; [1] &quot;numerics&quot;   &quot;factors&quot;    &quot;ordered&quot;    &quot;twoclass&quot;   &quot;multiclass&quot;</span></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
