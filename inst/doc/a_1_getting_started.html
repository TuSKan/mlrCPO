<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Martin Binder" />

<meta name="date" content="2017-12-15" />

<title>First Steps</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">First Steps</h1>
<h4 class="author"><em>Martin Binder</em></h4>
<h4 class="date"><em>2017-12-15</em></h4>



<div id="cpo-vignette-navigation" class="section level4">
<h4>CPO Vignette Navigation</h4>
<ol style="list-style-type: decimal">
<li>First Steps (<a href="z_1_getting_started_terse.html">compact version</a>)</li>
<li><a href="a_2_mlrCPO_core.html">mlrCPO Core</a> (<a href="z_2_mlrCPO_core_terse.html">compact version</a>)</li>
<li><a href="a_3_all_CPOs.html">CPOs Built Into mlrCPO</a> (<a href="z_3_all_CPOs_terse.html">compact version</a>)</li>
<li><a href="a_4_custom_CPOs.html">Building Custom CPOs</a> (<a href="z_4_custom_CPOs_terse.html">compact version</a>)</li>
</ol>
</div>
<div id="preprocessing-operators" class="section level2">
<h2>Preprocessing Operators</h2>
<p>Data preprocessing can be performed using the “mlrCPO” (“Composable Preprocessing Operators”) addon package for mlr. CPO makes it easy to use a variety of preprocessing operations, to chain different operations, and to integrate preprocessing with mlr learners, and to define custom preprocessing operations.</p>
<p>To chain different operations, to apply a CPO to a dataset, and to attach a CPO to a learner, the operator <code>%&gt;&gt;%</code> can be used. This way, it is possible to quickly create natural looking pipelines that are very flexible and can even be optimized over.</p>
<p>The following requires the <code>mlrCPO</code> package to be loaded:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;mlrCPO&quot;</span>)</code></pre></div>
</div>
<div id="cpo-objects" class="section level2">
<h2>CPO Objects</h2>
<p>Different preprocessing operations are provided in the form of <em>CPO Constructors</em>, which can be called like functions to create <em>CPO</em> objects. These CPO objects are then used to apply the operation to a data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpoScale  <span class="co"># a cpo constructor</span>
<span class="co">#&gt; &lt;&lt;CPO scale(center = TRUE, scale = TRUE)&gt;&gt;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(cpoScale, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)  <span class="co"># more information</span>
<span class="co">#&gt; &lt;&lt;CPO scale(center = TRUE, scale = TRUE)&gt;&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; cpo.trafo:</span>
<span class="co">#&gt; function (center = TRUE, scale = TRUE, data, target) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     result = scale(as.matrix(data), center = center, scale = scale)</span>
<span class="co">#&gt;     control = list(center = firstNonNull(attr(result, &quot;scaled:center&quot;), </span>
<span class="co">#&gt;         FALSE), scale = firstNonNull(attr(result, &quot;scaled:scale&quot;), </span>
<span class="co">#&gt;         FALSE))</span>
<span class="co">#&gt;     result</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;environment: namespace:mlrCPO&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; cpo.retrafo:</span>
<span class="co">#&gt; function (center = TRUE, scale = TRUE, data, control) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     scale(as.matrix(data), center = control$center, scale = control$scale)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;environment: namespace:mlrCPO&gt;</span>
<span class="kw">cpoScale</span>()  <span class="co"># create a CPO object that scales and centers data</span>
<span class="co">#&gt; scale(center = TRUE, scale = TRUE)</span></code></pre></div>
<p><code>CPO</code> objects are central to <code>mlrCPO</code>, and they are very flexible. They can be applied to a dataset or a Task:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>())
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667  setosa</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">getTaskData</span>(iris.task %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>()))
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667  setosa</span></code></pre></div>
<p>they can be concatenated to create new operations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cpoScale</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
<span class="co">#&gt; (scale &gt;&gt; pca)(scale.center = TRUE, scale.scale = TRUE, pca.center = TRUE, pca.scale = FALSE)</span></code></pre></div>
<p>and they can be fused with a <code>Learner</code> to create a machine learning pipeline that performs preprocessing on the learning data and also pre-processes the data that is fed to the model for prediction.</p>
<p>A list of all internal <code>CPO</code>s can be retrieved using <code>listCPO</code>, which returns a data frame of names, descriptions, and categories.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">listCPO</span>()$name
<span class="co">#&gt;  [1] &quot;cpoDropConstants&quot;                &quot;cpoFixFactors&quot;                  </span>
<span class="co">#&gt;  [3] &quot;cpoCollapseFact&quot;                 &quot;cpoAsNumeric&quot;                   </span>
<span class="co">#&gt;  [5] &quot;cpoCollapseFact&quot;                 &quot;cpoDummyEncode&quot;                 </span>
<span class="co">#&gt;  [7] &quot;cpoImpactEncodeClassif&quot;          &quot;cpoImpactEncodeRegr&quot;            </span>
<span class="co">#&gt;  [9] &quot;cpoProbEncode&quot;                   &quot;cpoSelect&quot;                      </span>
<span class="co">#&gt; [11] &quot;cpoSelectFreeProperties&quot;         &quot;cpoAddCols&quot;                     </span>
<span class="co">#&gt; [13] &quot;cpoMakeCols&quot;                     &quot;cpoApplyFun&quot;                    </span>
<span class="co">#&gt; [15] &quot;cpoModelMatrix&quot;                  &quot;cpoIca&quot;                         </span>
<span class="co">#&gt; [17] &quot;cpoPca&quot;                          &quot;cpoScale&quot;                       </span>
<span class="co">#&gt; [19] &quot;cpoScaleMaxAbs&quot;                  &quot;cpoScaleRange&quot;                  </span>
<span class="co">#&gt; [21] &quot;cpoSpatialSign&quot;                  &quot;cpoFilterFeatures&quot;              </span>
<span class="co">#&gt; [23] &quot;cpoFilterAnova&quot;                  &quot;cpoFilterCarscore&quot;              </span>
<span class="co">#&gt; [25] &quot;cpoFilterChiSquared&quot;             &quot;cpoFilterGainRatio&quot;             </span>
<span class="co">#&gt; [27] &quot;cpoFilterInformationGain&quot;        &quot;cpoFilterKruskal&quot;               </span>
<span class="co">#&gt; [29] &quot;cpoFilterLinearCorrelation&quot;      &quot;cpoFilterMrmr&quot;                  </span>
<span class="co">#&gt; [31] &quot;cpoFilterOneR&quot;                   &quot;cpoFilterPermutationImportance&quot; </span>
<span class="co">#&gt; [33] &quot;cpoFilterRankCorrelation&quot;        &quot;cpoFilterRelief&quot;                </span>
<span class="co">#&gt; [35] &quot;cpoFilterRfCImportance&quot;          &quot;cpoFilterRfImportance&quot;          </span>
<span class="co">#&gt; [37] &quot;cpoFilterRfSRCImportance&quot;        &quot;cpoFilterRfSRCMinDepth&quot;         </span>
<span class="co">#&gt; [39] &quot;cpoFilterSymmetricalUncertainty&quot; &quot;cpoFilterUnivariate&quot;            </span>
<span class="co">#&gt; [41] &quot;cpoFilterVariance&quot;               &quot;cpoImpute&quot;                      </span>
<span class="co">#&gt; [43] &quot;cpoImputeAll&quot;                    &quot;cpoImputeConstant&quot;              </span>
<span class="co">#&gt; [45] &quot;cpoImputeHist&quot;                   &quot;cpoImputeLearner&quot;               </span>
<span class="co">#&gt; [47] &quot;cpoImputeMax&quot;                    &quot;cpoImputeMean&quot;                  </span>
<span class="co">#&gt; [49] &quot;cpoImputeMedian&quot;                 &quot;cpoImputeMin&quot;                   </span>
<span class="co">#&gt; [51] &quot;cpoImputeMode&quot;                   &quot;cpoImputeNormal&quot;                </span>
<span class="co">#&gt; [53] &quot;cpoImputeUniform&quot;                &quot;cpoCache&quot;                       </span>
<span class="co">#&gt; [55] &quot;cpoCase&quot;                         &quot;cpoCbind&quot;                       </span>
<span class="co">#&gt; [57] &quot;cpoMultiplex&quot;                    &quot;cpoTransformParams&quot;             </span>
<span class="co">#&gt; [59] &quot;cpoWrap&quot;                         &quot;cpoWrapRetrafoless&quot;             </span>
<span class="co">#&gt; [61] &quot;cpoMissingIndicators&quot;</span></code></pre></div>
</div>
<div id="retrafo" class="section level2">
<h2>Retrafo</h2>
<p>Manipulating data for preprocessing itself is relatively easy. A challenge comes when one wants to integrate preprocessing into a machine-learning pipeline: The same preprocessing steps that are performed on the training data need to be performed on the new prediction data. However, the transformation performed for prediction often needs information from the training step. For example, if training entail performing PCA, then for prediction, the data must not undergo another PCA, instead it needs to be rotated by the rotation matrix found by the training PCA. The process of obtaining the rotation matrix will be called “training” the <code>CPO</code>, and the object that contains the trained information is called <code>CPOTrained</code>. For preprocessing operations that operate only on <em>features</em> of a task (as opposed to the target column), the <code>CPOTrained</code> will always be applied to new incoming data, and hence be of class <code>CPORetrafo</code> and called a “retrafo” object. To obtain this retrafo object, one can use <code>retrafo()</code>. Retrafo objects can be applied to data just as <code>CPO</code>s can, by using the <code>%&gt;&gt;%</code> operator.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">transformed =<span class="st"> </span>iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
ret =<span class="st"> </span><span class="kw">retrafo</span>(transformed)
<span class="kw">print</span>(ret)
<span class="co">#&gt; CPO Retrafo chain</span>
<span class="co">#&gt; [RETRAFO pca(center = TRUE, scale = FALSE)]</span></code></pre></div>
<p>Comparing the first lines of the transformed data with the lines of “retransforming” the same input data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(transformed)
<span class="co">#&gt;   Species       PC1        PC2         PC3          PC4</span>
<span class="co">#&gt; 1  setosa -2.684126 -0.3193972  0.02791483  0.002262437</span>
<span class="co">#&gt; 2  setosa -2.714142  0.1770012  0.21046427  0.099026550</span>
<span class="co">#&gt; 3  setosa -2.888991  0.1449494 -0.01790026  0.019968390</span>
<span class="co">#&gt; 4  setosa -2.745343  0.3182990 -0.03155937 -0.075575817</span>
<span class="co">#&gt; 5  setosa -2.728717 -0.3267545 -0.09007924 -0.061258593</span>
<span class="co">#&gt; 6  setosa -2.280860 -0.7413304 -0.16867766 -0.024200858</span>
<span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span>ret
<span class="co">#&gt;   Species       PC1        PC2         PC3          PC4</span>
<span class="co">#&gt; 1  setosa -2.684126 -0.3193972  0.02791483  0.002262437</span>
<span class="co">#&gt; 2  setosa -2.714142  0.1770012  0.21046427  0.099026550</span>
<span class="co">#&gt; 3  setosa -2.888991  0.1449494 -0.01790026  0.019968390</span>
<span class="co">#&gt; 4  setosa -2.745343  0.3182990 -0.03155937 -0.075575817</span>
<span class="co">#&gt; 5  setosa -2.728717 -0.3267545 -0.09007924 -0.061258593</span>
<span class="co">#&gt; 6  setosa -2.280860 -0.7413304 -0.16867766 -0.024200858</span></code></pre></div>
<p>Note that using the PCA on only the head of ‘iris’ gives a different (wrong) result:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
<span class="co">#&gt;   Species        PC1          PC2         PC3           PC4</span>
<span class="co">#&gt; 1  setosa -0.1634147  0.017230444 -0.11038321 -0.0231625616</span>
<span class="co">#&gt; 2  setosa  0.3324970 -0.189351624 -0.08152883  0.0005612917</span>
<span class="co">#&gt; 3  setosa  0.3268659  0.101103375 -0.02238439  0.0464537730</span>
<span class="co">#&gt; 4  setosa  0.4202367  0.005523981  0.17106514 -0.0222757931</span>
<span class="co">#&gt; 5  setosa -0.1768684  0.140149101 -0.04185224 -0.0194870755</span>
<span class="co">#&gt; 6  setosa -0.7393165 -0.074655279  0.08508352  0.0179103657</span></code></pre></div>
<p>When attaching a <code>CPO</code> to a <code>Learner</code> using the <code>%&gt;&gt;%</code>-operator, all this is performed by <code>mlrCPO</code>, so there is no need to worry about keeping <code>CPOTrained</code> objects around.</p>
<p><code>retrafo()</code> gets the retrafo object from an attribute of the <code>transformed</code> object. The retrafo is always generated by the application of a <code>CPO</code> already. Retrafos that are attached to an object also stack, so multiple applications of different <code>CPO</code>s only need one <code>retrafo()</code> call to get the respective retrafo operation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trans.a =<span class="st"> </span>iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoScale</span>()
trans.b =<span class="st"> </span>trans.a %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
ret =<span class="st"> </span><span class="kw">retrafo</span>(trans.b)</code></pre></div>
<p>Check that ‘ret’ does what it is supposed to do:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(trans.b)
<span class="co">#&gt;   Species       PC1        PC2         PC3          PC4</span>
<span class="co">#&gt; 1  setosa -2.257141 -0.4784238  0.12727962  0.024087508</span>
<span class="co">#&gt; 2  setosa -2.074013  0.6718827  0.23382552  0.102662845</span>
<span class="co">#&gt; 3  setosa -2.356335  0.3407664 -0.04405390  0.028282305</span>
<span class="co">#&gt; 4  setosa -2.291707  0.5953999 -0.09098530 -0.065735340</span>
<span class="co">#&gt; 5  setosa -2.381863 -0.6446757 -0.01568565 -0.035802870</span>
<span class="co">#&gt; 6  setosa -2.068701 -1.4842053 -0.02687825  0.006586116</span>
<span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span>ret
<span class="co">#&gt;   Species       PC1        PC2         PC3          PC4</span>
<span class="co">#&gt; 1  setosa -2.257141 -0.4784238  0.12727962  0.024087508</span>
<span class="co">#&gt; 2  setosa -2.074013  0.6718827  0.23382552  0.102662845</span>
<span class="co">#&gt; 3  setosa -2.356335  0.3407664 -0.04405390  0.028282305</span>
<span class="co">#&gt; 4  setosa -2.291707  0.5953999 -0.09098530 -0.065735340</span>
<span class="co">#&gt; 5  setosa -2.381863 -0.6446757 -0.01568565 -0.035802870</span>
<span class="co">#&gt; 6  setosa -2.068701 -1.4842053 -0.02687825  0.006586116</span></code></pre></div>
</div>
<div id="hyperparameters" class="section level2">
<h2>Hyperparameters</h2>
<p><code>CPO</code> objects have hyperparameters that can be adjusted at creation, or later using <code>setHyperPars</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(cpoScale)
<span class="co">#&gt; &lt;&lt;CPO scale(center = TRUE, scale = TRUE)&gt;&gt;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">do.center =<span class="st"> </span><span class="kw">cpoScale</span>(<span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">center =</span> <span class="ot">TRUE</span>)
<span class="kw">print</span>(do.center, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)  <span class="co"># note the 'scale.' prefix of parameters</span>
<span class="co">#&gt; Trafo chain of 1 cpos:</span>
<span class="co">#&gt; scale(center = TRUE, scale = FALSE)</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt;                 Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; scale.center logical   - TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; scale.scale  logical   - TRUE      -   -    TRUE     -</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">do.scale =<span class="st"> </span><span class="kw">setHyperPars</span>(do.center,
  <span class="dt">scale.scale =</span> <span class="ot">TRUE</span>, <span class="dt">scale.center =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>These hyperparameters even survive <code>CPO</code> composition and attachment to Learners:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpo =<span class="st"> </span><span class="kw">cpoScale</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
lrn =<span class="st"> </span>cpo %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.logreg&quot;</span>)
<span class="kw">print</span>(lrn)
<span class="co">#&gt; Learner classif.logreg.pca.scale from package stats</span>
<span class="co">#&gt; Type: classif</span>
<span class="co">#&gt; Name: ; Short name: </span>
<span class="co">#&gt; Class: CPOLearner</span>
<span class="co">#&gt; Properties: numerics,factors,twoclass,prob</span>
<span class="co">#&gt; Predict-Type: response</span>
<span class="co">#&gt; Hyperparameters: model=FALSE</span></code></pre></div>
<div id="tuning" class="section level3">
<h3>Tuning</h3>
<p>Since the hyperparameters remain intact for learners, is possible to tune hyperparameters parameters of preprocessing operations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">clrn =</span> <span class="kw">cpoModelMatrix</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.logreg&quot;</span>))
<span class="co">#&gt; Learner classif.logreg.model.matrix from package stats</span>
<span class="co">#&gt; Type: classif</span>
<span class="co">#&gt; Name: ; Short name: </span>
<span class="co">#&gt; Class: CPOLearner</span>
<span class="co">#&gt; Properties: numerics,factors,ordered,twoclass,prob</span>
<span class="co">#&gt; Predict-Type: response</span>
<span class="co">#&gt; Hyperparameters: model=FALSE</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getParamSet</span>(clrn)
<span class="co">#&gt;                         Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; model.matrix.formula untyped   -    -      -   -    TRUE     -</span>
<span class="co">#&gt; model                logical   - TRUE      -   -   FALSE     -</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ps =<span class="st"> </span><span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;model.matrix.formula&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">first =</span> ~<span class="dv">0</span> +<span class="st"> </span>., <span class="dt">second =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">2</span>, <span class="dt">third =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">3</span>)))

<span class="kw">tuneParams</span>(clrn, pid.task, cv5, <span class="dt">par.set =</span> ps,
           <span class="dt">control =</span> <span class="kw">makeTuneControlGrid</span>(),
           <span class="dt">show.info=</span><span class="ot">TRUE</span>)
<span class="co">#&gt; [Tune] Started tuning learner classif.logreg.model.matrix for parameter set:</span>
<span class="co">#&gt;                          Type len Def             Constr Req Tunable Trafo</span>
<span class="co">#&gt; model.matrix.formula discrete   -   - first,second,third   -    TRUE     -</span>
<span class="co">#&gt; With control class: TuneControlGrid</span>
<span class="co">#&gt; Imputation value: 1</span>
<span class="co">#&gt; [Tune-x] 1: model.matrix.formula=first</span>
<span class="co">#&gt; [Tune-y] 1: mmce.test.mean=0.2226127; time: 0.0 min</span>
<span class="co">#&gt; [Tune-x] 2: model.matrix.formula=second</span>
<span class="co">#&gt; [Tune-y] 2: mmce.test.mean=0.2278584; time: 0.0 min</span>
<span class="co">#&gt; [Tune-x] 3: model.matrix.formula=third</span>
<span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span>

<span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span>

<span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span>

<span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="co">#&gt; [Tune-y] 3: mmce.test.mean=0.2747390; time: 0.0 min</span>
<span class="co">#&gt; [Tune] Result: model.matrix.formula=first : mmce.test.mean=0.2226127</span>
<span class="co">#&gt; Tune result:</span>
<span class="co">#&gt; Op. pars: model.matrix.formula=first</span>
<span class="co">#&gt; mmce.test.mean=0.2226127</span></code></pre></div>
</div>
</div>
<div id="special-cpos" class="section level2">
<h2>Special CPOs</h2>
<div id="cpo-multiplexer" class="section level3">
<h3>CPO Multiplexer</h3>
<p>The multiplexer makes it possible to combine many CPOs into one, with an extra <code>selected.cpo</code> parameter that chooses between them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpm =<span class="st"> </span><span class="kw">cpoMultiplex</span>(<span class="kw">list</span>(cpoScale, cpoPca))
<span class="kw">print</span>(cpm, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Trafo chain of 1 cpos:</span>
<span class="co">#&gt; multiplex(selected.cpo = scale, scale.center = TRUE, scale.scale = TRUE, pca.center = TRUE, pca.scale = FALSE)</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt;                  Type len   Def    Constr Req Tunable Trafo</span>
<span class="co">#&gt; selected.cpo discrete   - scale scale,pca   -    TRUE     -</span>
<span class="co">#&gt; scale.center  logical   -  TRUE         -   Y    TRUE     -</span>
<span class="co">#&gt; scale.scale   logical   -  TRUE         -   Y    TRUE     -</span>
<span class="co">#&gt; pca.center    logical   -  TRUE         -   Y    TRUE     -</span>
<span class="co">#&gt; pca.scale     logical   - FALSE         -   Y    TRUE     -</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpm, <span class="dt">selected.cpo =</span> <span class="st">&quot;scale&quot;</span>))
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667  setosa</span></code></pre></div>
<p>Every CPO’s Hyperparameters are exported:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpm, <span class="dt">selected.cpo =</span> <span class="st">&quot;scale&quot;</span>, <span class="dt">scale.center =</span> <span class="ot">FALSE</span>))
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1    0.8613268   1.1296201    0.3362663    0.140405  setosa</span>
<span class="co">#&gt; 2    0.8275493   0.9682458    0.3362663    0.140405  setosa</span>
<span class="co">#&gt; 3    0.7937718   1.0327956    0.3122473    0.140405  setosa</span>
<span class="co">#&gt; 4    0.7768830   1.0005207    0.3602853    0.140405  setosa</span>
<span class="co">#&gt; 5    0.8444380   1.1618950    0.3362663    0.140405  setosa</span>
<span class="co">#&gt; 6    0.9119931   1.2587196    0.4083234    0.280810  setosa</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpm, <span class="dt">selected.cpo =</span> <span class="st">&quot;pca&quot;</span>))
<span class="co">#&gt;   Species       PC1        PC2         PC3          PC4</span>
<span class="co">#&gt; 1  setosa -2.684126 -0.3193972  0.02791483  0.002262437</span>
<span class="co">#&gt; 2  setosa -2.714142  0.1770012  0.21046427  0.099026550</span>
<span class="co">#&gt; 3  setosa -2.888991  0.1449494 -0.01790026  0.019968390</span>
<span class="co">#&gt; 4  setosa -2.745343  0.3182990 -0.03155937 -0.075575817</span>
<span class="co">#&gt; 5  setosa -2.728717 -0.3267545 -0.09007924 -0.061258593</span>
<span class="co">#&gt; 6  setosa -2.280860 -0.7413304 -0.16867766 -0.024200858</span></code></pre></div>
<p>This makes it possible to tune over many different tuner configurations at once.</p>
</div>
<div id="cpo-wrapper" class="section level3">
<h3>CPO Wrapper</h3>
<p>A simple CPO with one parameter which gets applied to the data as CPO. This is different from a multiplexer in that its parameter is free and can take any value that behaves like a CPO. On the downside, this does not expose the argument’s parameters to the outside.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpa =<span class="st"> </span><span class="kw">cpoWrap</span>()
<span class="kw">print</span>(cpa, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Trafo chain of 1 cpos:</span>
<span class="co">#&gt; wrap()</span>
<span class="co">#&gt; Operating: feature</span>
<span class="co">#&gt; ParamSet:</span>
<span class="co">#&gt;             Type len Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; wrap.cpo untyped   -   -      -   -    TRUE     -</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpa, <span class="dt">wrap.cpo =</span> <span class="kw">cpoScale</span>()))
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667  setosa</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">setHyperPars</span>(cpa, <span class="dt">wrap.cpo =</span> <span class="kw">cpoPca</span>()))
<span class="co">#&gt;   Species       PC1        PC2         PC3          PC4</span>
<span class="co">#&gt; 1  setosa -2.684126 -0.3193972  0.02791483  0.002262437</span>
<span class="co">#&gt; 2  setosa -2.714142  0.1770012  0.21046427  0.099026550</span>
<span class="co">#&gt; 3  setosa -2.888991  0.1449494 -0.01790026  0.019968390</span>
<span class="co">#&gt; 4  setosa -2.745343  0.3182990 -0.03155937 -0.075575817</span>
<span class="co">#&gt; 5  setosa -2.728717 -0.3267545 -0.09007924 -0.061258593</span>
<span class="co">#&gt; 6  setosa -2.280860 -0.7413304 -0.16867766 -0.024200858</span></code></pre></div>
<p>Attaching the cpo applicator to a learner gives this learner a “cpo” hyperparameter that can be set to any CPO.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getParamSet</span>(<span class="kw">cpoWrap</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.logreg&quot;</span>))
<span class="co">#&gt;             Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; wrap.cpo untyped   -    -      -   -    TRUE     -</span>
<span class="co">#&gt; model    logical   - TRUE      -   -   FALSE     -</span></code></pre></div>
</div>
<div id="cbind-cpo" class="section level3">
<h3>CBind CPO</h3>
<p><code>cbind</code> other CPOs as operation. The <code>cbinder</code> makes it possible to build DAGs of CPOs that perform different operations on data and paste the results next to each other.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scale =<span class="st"> </span><span class="kw">cpoScale</span>(<span class="dt">id =</span> <span class="st">&quot;scale&quot;</span>)
scale.pca =<span class="st"> </span>scale %&gt;&gt;%<span class="st"> </span><span class="kw">cpoPca</span>()
cbinder =<span class="st"> </span><span class="kw">cpoCbind</span>(<span class="dt">scaled =</span> scale, <span class="dt">pcad =</span> scale.pca, <span class="dt">original =</span> NULLCPO)</code></pre></div>
<p><code>cpoCbind</code> recognises that <code>&quot;scale.scale&quot;</code> happens before <code>&quot;pca.pca&quot;</code> but is also fed to the result directly. The summary draws a (crude) ascii-art graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(cbinder)
<span class="co">#&gt; cbind(scale.center = TRUE, scale.scale = TRUE, pca.center = TRUE, pca.scale = FALSE)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getParamSet</span>(cbinder)
<span class="co">#&gt;                 Type len   Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; scale.center logical   -  TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; scale.scale  logical   -  TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; pca.center   logical   -  TRUE      -   -    TRUE     -</span>
<span class="co">#&gt; pca.scale    logical   - FALSE      -   -    TRUE     -</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span>cbinder)
<span class="co">#&gt;   scaled.Sepal.Length scaled.Sepal.Width scaled.Petal.Length</span>
<span class="co">#&gt; 1          -0.8976739         1.01560199           -1.335752</span>
<span class="co">#&gt; 2          -1.1392005        -0.13153881           -1.335752</span>
<span class="co">#&gt; 3          -1.3807271         0.32731751           -1.392399</span>
<span class="co">#&gt; 4          -1.5014904         0.09788935           -1.279104</span>
<span class="co">#&gt; 5          -1.0184372         1.24503015           -1.335752</span>
<span class="co">#&gt; 6          -0.5353840         1.93331463           -1.165809</span>
<span class="co">#&gt;   scaled.Petal.Width scaled.Species pcad.Species  pcad.PC1   pcad.PC2</span>
<span class="co">#&gt; 1          -1.311052         setosa       setosa -2.257141 -0.4784238</span>
<span class="co">#&gt; 2          -1.311052         setosa       setosa -2.074013  0.6718827</span>
<span class="co">#&gt; 3          -1.311052         setosa       setosa -2.356335  0.3407664</span>
<span class="co">#&gt; 4          -1.311052         setosa       setosa -2.291707  0.5953999</span>
<span class="co">#&gt; 5          -1.311052         setosa       setosa -2.381863 -0.6446757</span>
<span class="co">#&gt; 6          -1.048667         setosa       setosa -2.068701 -1.4842053</span>
<span class="co">#&gt;      pcad.PC3     pcad.PC4 original.Sepal.Length original.Sepal.Width</span>
<span class="co">#&gt; 1  0.12727962  0.024087508                   5.1                  3.5</span>
<span class="co">#&gt; 2  0.23382552  0.102662845                   4.9                  3.0</span>
<span class="co">#&gt; 3 -0.04405390  0.028282305                   4.7                  3.2</span>
<span class="co">#&gt; 4 -0.09098530 -0.065735340                   4.6                  3.1</span>
<span class="co">#&gt; 5 -0.01568565 -0.035802870                   5.0                  3.6</span>
<span class="co">#&gt; 6 -0.02687825  0.006586116                   5.4                  3.9</span>
<span class="co">#&gt;   original.Petal.Length original.Petal.Width original.Species</span>
<span class="co">#&gt; 1                   1.4                  0.2           setosa</span>
<span class="co">#&gt; 2                   1.4                  0.2           setosa</span>
<span class="co">#&gt; 3                   1.3                  0.2           setosa</span>
<span class="co">#&gt; 4                   1.5                  0.2           setosa</span>
<span class="co">#&gt; 5                   1.4                  0.2           setosa</span>
<span class="co">#&gt; 6                   1.7                  0.4           setosa</span></code></pre></div>
<p>The unnecessary copies of “Species” are unfortunate. Remove them with cpoSelect:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">selector =<span class="st"> </span><span class="kw">cpoSelect</span>(<span class="dt">type =</span> <span class="st">&quot;numeric&quot;</span>)
cbinder.select =<span class="st"> </span><span class="kw">cpoCbind</span>(<span class="dt">scaled =</span> selector %&gt;&gt;%<span class="st"> </span>scale, <span class="dt">pcad =</span> selector %&gt;&gt;%<span class="st"> </span>scale.pca, <span class="dt">original =</span> NULLCPO)
cbinder.select
<span class="co">#&gt; cbind(select.type = numeric, select.index = integer(0), select.names = character(0), select.pattern = &lt;NULL&gt;, select.pattern.ignore.case = FALSE, select.pattern.perl = FALSE, select.pattern.fixed = FALSE, select.invert = FALSE, scale.center = TRUE, scale.scale = TRUE, pca.center = TRUE, pca.scale = FALSE)</span>
<span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span>cbinder)
<span class="co">#&gt;   scaled.Sepal.Length scaled.Sepal.Width scaled.Petal.Length</span>
<span class="co">#&gt; 1          -0.8976739         1.01560199           -1.335752</span>
<span class="co">#&gt; 2          -1.1392005        -0.13153881           -1.335752</span>
<span class="co">#&gt; 3          -1.3807271         0.32731751           -1.392399</span>
<span class="co">#&gt; 4          -1.5014904         0.09788935           -1.279104</span>
<span class="co">#&gt; 5          -1.0184372         1.24503015           -1.335752</span>
<span class="co">#&gt; 6          -0.5353840         1.93331463           -1.165809</span>
<span class="co">#&gt;   scaled.Petal.Width scaled.Species pcad.Species  pcad.PC1   pcad.PC2</span>
<span class="co">#&gt; 1          -1.311052         setosa       setosa -2.257141 -0.4784238</span>
<span class="co">#&gt; 2          -1.311052         setosa       setosa -2.074013  0.6718827</span>
<span class="co">#&gt; 3          -1.311052         setosa       setosa -2.356335  0.3407664</span>
<span class="co">#&gt; 4          -1.311052         setosa       setosa -2.291707  0.5953999</span>
<span class="co">#&gt; 5          -1.311052         setosa       setosa -2.381863 -0.6446757</span>
<span class="co">#&gt; 6          -1.048667         setosa       setosa -2.068701 -1.4842053</span>
<span class="co">#&gt;      pcad.PC3     pcad.PC4 original.Sepal.Length original.Sepal.Width</span>
<span class="co">#&gt; 1  0.12727962  0.024087508                   5.1                  3.5</span>
<span class="co">#&gt; 2  0.23382552  0.102662845                   4.9                  3.0</span>
<span class="co">#&gt; 3 -0.04405390  0.028282305                   4.7                  3.2</span>
<span class="co">#&gt; 4 -0.09098530 -0.065735340                   4.6                  3.1</span>
<span class="co">#&gt; 5 -0.01568565 -0.035802870                   5.0                  3.6</span>
<span class="co">#&gt; 6 -0.02687825  0.006586116                   5.4                  3.9</span>
<span class="co">#&gt;   original.Petal.Length original.Petal.Width original.Species</span>
<span class="co">#&gt; 1                   1.4                  0.2           setosa</span>
<span class="co">#&gt; 2                   1.4                  0.2           setosa</span>
<span class="co">#&gt; 3                   1.3                  0.2           setosa</span>
<span class="co">#&gt; 4                   1.5                  0.2           setosa</span>
<span class="co">#&gt; 5                   1.4                  0.2           setosa</span>
<span class="co">#&gt; 6                   1.7                  0.4           setosa</span></code></pre></div>
<p>alternatively, we apply the cbinder only to numerical data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(iris %&gt;&gt;%<span class="st"> </span><span class="kw">cpoWrap</span>(cbinder, <span class="dt">affect.type =</span> <span class="st">&quot;numeric&quot;</span>))
<span class="co">#&gt;   Species scaled.Sepal.Length scaled.Sepal.Width scaled.Petal.Length</span>
<span class="co">#&gt; 1  setosa          -0.8976739         1.01560199           -1.335752</span>
<span class="co">#&gt; 2  setosa          -1.1392005        -0.13153881           -1.335752</span>
<span class="co">#&gt; 3  setosa          -1.3807271         0.32731751           -1.392399</span>
<span class="co">#&gt; 4  setosa          -1.5014904         0.09788935           -1.279104</span>
<span class="co">#&gt; 5  setosa          -1.0184372         1.24503015           -1.335752</span>
<span class="co">#&gt; 6  setosa          -0.5353840         1.93331463           -1.165809</span>
<span class="co">#&gt;   scaled.Petal.Width  pcad.PC1   pcad.PC2    pcad.PC3     pcad.PC4</span>
<span class="co">#&gt; 1          -1.311052 -2.257141 -0.4784238  0.12727962  0.024087508</span>
<span class="co">#&gt; 2          -1.311052 -2.074013  0.6718827  0.23382552  0.102662845</span>
<span class="co">#&gt; 3          -1.311052 -2.356335  0.3407664 -0.04405390  0.028282305</span>
<span class="co">#&gt; 4          -1.311052 -2.291707  0.5953999 -0.09098530 -0.065735340</span>
<span class="co">#&gt; 5          -1.311052 -2.381863 -0.6446757 -0.01568565 -0.035802870</span>
<span class="co">#&gt; 6          -1.048667 -2.068701 -1.4842053 -0.02687825  0.006586116</span>
<span class="co">#&gt;   original.Sepal.Length original.Sepal.Width original.Petal.Length</span>
<span class="co">#&gt; 1                   5.1                  3.5                   1.4</span>
<span class="co">#&gt; 2                   4.9                  3.0                   1.4</span>
<span class="co">#&gt; 3                   4.7                  3.2                   1.3</span>
<span class="co">#&gt; 4                   4.6                  3.1                   1.5</span>
<span class="co">#&gt; 5                   5.0                  3.6                   1.4</span>
<span class="co">#&gt; 6                   5.4                  3.9                   1.7</span>
<span class="co">#&gt;   original.Petal.Width</span>
<span class="co">#&gt; 1                  0.2</span>
<span class="co">#&gt; 2                  0.2</span>
<span class="co">#&gt; 3                  0.2</span>
<span class="co">#&gt; 4                  0.2</span>
<span class="co">#&gt; 5                  0.2</span>
<span class="co">#&gt; 6                  0.4</span></code></pre></div>
</div>
</div>
<div id="custom-cpos" class="section level2">
<h2>Custom CPOs</h2>
<p>Even though <code>CPO</code>s are very flexible and can be combined in many ways, it may be necessary to create completely custom <code>CPO</code>s. Custom CPOs can be created using the <code>makeCPO</code> function. Its most important arguments are <code>cpo.trafo</code> and <code>cpo.retrafo</code>, both of which are functions. In principle, a <code>CPO</code> needs a function that “trains” a control object depending on the data (<code>cpo.trafo</code>), and another function that uses this control object, and new data, to perform the preprocessing operation (<code>cpo.retrafo</code>). The <code>cpo.trafo</code>-function must return a “control” object which contains all information about how to transform a given dataset. <code>cpo.retrafo</code> takes a (potentially new!) dataset <em>and</em> the “control” object returned by <code>cpo.trafo</code>, and transforms the new data according to plan.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(<span class="kw">formals</span>(makeCPO))  <span class="co"># see help(makeCPO) for explanation of arguments</span>
<span class="co">#&gt;  [1] &quot;cpo.name&quot;                       &quot;par.set&quot;                       </span>
<span class="co">#&gt;  [3] &quot;par.vals&quot;                       &quot;dataformat&quot;                    </span>
<span class="co">#&gt;  [5] &quot;dataformat.factor.with.ordered&quot; &quot;export.params&quot;                 </span>
<span class="co">#&gt;  [7] &quot;fix.factors&quot;                    &quot;properties.data&quot;               </span>
<span class="co">#&gt;  [9] &quot;properties.adding&quot;              &quot;properties.needed&quot;             </span>
<span class="co">#&gt; [11] &quot;properties.target&quot;              &quot;packages&quot;                      </span>
<span class="co">#&gt; [13] &quot;cpo.train&quot;                      &quot;cpo.retrafo&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">constFeatRem =<span class="st"> </span><span class="kw">makeCPO</span>(<span class="st">&quot;constFeatRem&quot;</span>,
  <span class="dt">dataformat =</span> <span class="st">&quot;df.features&quot;</span>,
  <span class="dt">cpo.train =</span> function(data, target) {
    <span class="kw">names</span>(<span class="kw">Filter</span>(function(x) {  <span class="co"># names of columns to keep</span>
        <span class="kw">length</span>(<span class="kw">unique</span>(x)) &gt;<span class="st"> </span><span class="dv">1</span>
      }, data))
    }, <span class="dt">cpo.retrafo =</span> function(data, control) {
    data[control]
  })
<span class="kw">head</span>(iris) %&gt;&gt;%<span class="st"> </span><span class="kw">constFeatRem</span>()
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="co">#&gt; 1          5.1         3.5          1.4         0.2</span>
<span class="co">#&gt; 2          4.9         3.0          1.4         0.2</span>
<span class="co">#&gt; 3          4.7         3.2          1.3         0.2</span>
<span class="co">#&gt; 4          4.6         3.1          1.5         0.2</span>
<span class="co">#&gt; 5          5.0         3.6          1.4         0.2</span>
<span class="co">#&gt; 6          5.4         3.9          1.7         0.4</span>
<span class="kw">print</span>(constFeatRem, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; &lt;&lt;CPO constFeatRem()&gt;&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; cpo.trafo:</span>
<span class="co">#&gt; function(data, target) {</span>
<span class="co">#&gt;     names(Filter(function(x) {  # names of columns to keep</span>
<span class="co">#&gt;         length(unique(x)) &gt; 1</span>
<span class="co">#&gt;       }, data))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; cpo.retrafo:</span>
<span class="co">#&gt; function(data, control) {</span>
<span class="co">#&gt;     data[control]</span>
<span class="co">#&gt;   }</span></code></pre></div>
</div>
<div id="tuning-cpo" class="section level2">
<h2>Tuning CPO</h2>
<p>CPOs export their parameters when attached to a learner. Tuning of CPO-Learners works exactly as tuning for ordinary Learners.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">clrn =</span> <span class="kw">cpoModelMatrix</span>() %&gt;&gt;%<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.logreg&quot;</span>))
<span class="co">#&gt; Learner classif.logreg.model.matrix from package stats</span>
<span class="co">#&gt; Type: classif</span>
<span class="co">#&gt; Name: ; Short name: </span>
<span class="co">#&gt; Class: CPOLearner</span>
<span class="co">#&gt; Properties: numerics,factors,ordered,twoclass,prob</span>
<span class="co">#&gt; Predict-Type: response</span>
<span class="co">#&gt; Hyperparameters: model=FALSE</span>
<span class="kw">getParamSet</span>(clrn)
<span class="co">#&gt;                         Type len  Def Constr Req Tunable Trafo</span>
<span class="co">#&gt; model.matrix.formula untyped   -    -      -   -    TRUE     -</span>
<span class="co">#&gt; model                logical   - TRUE      -   -   FALSE     -</span>

ps =<span class="st"> </span><span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;model.matrix.formula&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">first =</span> ~<span class="dv">0</span> +<span class="st"> </span>., <span class="dt">second =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">2</span>, <span class="dt">third =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">3</span>)))

<span class="kw">tuneParams</span>(clrn, pid.task, cv5, <span class="dt">par.set =</span> ps,
           <span class="dt">control =</span> <span class="kw">makeTuneControlGrid</span>(),
           <span class="dt">show.info=</span><span class="ot">TRUE</span>)
<span class="co">#&gt; [Tune] Started tuning learner classif.logreg.model.matrix for parameter set:</span>
<span class="co">#&gt;                          Type len Def             Constr Req Tunable Trafo</span>
<span class="co">#&gt; model.matrix.formula discrete   -   - first,second,third   -    TRUE     -</span>
<span class="co">#&gt; With control class: TuneControlGrid</span>
<span class="co">#&gt; Imputation value: 1</span>
<span class="co">#&gt; [Tune-x] 1: model.matrix.formula=first</span>
<span class="co">#&gt; [Tune-y] 1: mmce.test.mean=0.2317036; time: 0.0 min</span>
<span class="co">#&gt; [Tune-x] 2: model.matrix.formula=second</span>
<span class="co">#&gt; [Tune-y] 2: mmce.test.mean=0.2473814; time: 0.0 min</span>
<span class="co">#&gt; [Tune-x] 3: model.matrix.formula=third</span>
<span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span>

<span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span>

<span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="co">#&gt; [Tune-y] 3: mmce.test.mean=0.2681691; time: 0.0 min</span>
<span class="co">#&gt; [Tune] Result: model.matrix.formula=first : mmce.test.mean=0.2317036</span>
<span class="co">#&gt; Tune result:</span>
<span class="co">#&gt; Op. pars: model.matrix.formula=first</span>
<span class="co">#&gt; mmce.test.mean=0.2317036</span></code></pre></div>
<p>Tuning of CPOs and tuning of Learners can happen at the same time. The following is not executed to save build time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tlrn =<span class="st"> </span><span class="kw">cpoModelMatrix</span>() %&gt;&gt;%
<span class="st">       </span><span class="kw">cpoWrap</span>() %&gt;&gt;%
<span class="st">       </span><span class="kw">cpoFilterGainRatio</span>() %&gt;&gt;%
<span class="st">       </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.ctree&quot;</span>)
<span class="kw">sprintf</span>(<span class="st">&quot;Parameters: %s&quot;</span>, <span class="kw">paste</span>(<span class="kw">names</span>(<span class="kw">getParamSet</span>(tlrn)$pars), <span class="dt">collapse=</span><span class="st">&quot;, &quot;</span>))
ps2 =<span class="st"> </span><span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;model.matrix.formula&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">first =</span> ~<span class="dv">0</span> +<span class="st"> </span>., <span class="dt">second =</span> ~<span class="dv">0</span> +<span class="st"> </span>.^<span class="dv">2</span>)),
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;wrap.cpo&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">nopca =</span> NULLCPO,
                      <span class="dt">onlypca =</span> <span class="kw">cpoPca</span>(),
                      <span class="dt">addpca =</span> <span class="kw">cpoCbind</span>(NULLCPO, <span class="kw">cpoPca</span>()))),
    <span class="kw">makeDiscreteParam</span>(
        <span class="st">&quot;gain.ratio.perc&quot;</span>,
        <span class="dt">values =</span> <span class="kw">list</span>(<span class="fl">0.333</span>, <span class="fl">0.667</span>, <span class="fl">1.0</span>)),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;teststat&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;quad&quot;</span>, <span class="st">&quot;max&quot;</span>)))

<span class="kw">tuneParams</span>(tlrn, pid.task, cv5, <span class="dt">par.set =</span> ps2,
           <span class="dt">control =</span> <span class="kw">makeTuneControlGrid</span>())</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
